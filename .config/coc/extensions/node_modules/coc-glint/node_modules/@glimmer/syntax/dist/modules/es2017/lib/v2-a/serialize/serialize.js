import { SourceSlice } from '../../source/slice';
export class RefSerializer {
  arg(ref) {
    return {
      type: 'Arg',
      loc: ref.loc.serialize(),
      name: ref.name.serialize()
    };
  }

  free(ref) {
    return {
      type: 'Free',
      loc: ref.loc.serialize(),
      resolution: ref.resolution.serialize(),
      name: ref.name
    };
  }

  local(ref) {
    return {
      type: 'Local',
      loc: ref.loc.serialize(),
      name: ref.name
    };
  }

  self(ref) {
    return {
      type: 'This',
      loc: ref.loc.serialize()
    };
  }

}
const REF = new RefSerializer();
export class ExprSerializer {
  literal(literal) {
    return {
      type: 'Literal',
      loc: literal.loc.serialize(),
      value: literal.value
    };
  }

  path(path) {
    return {
      type: 'Path',
      loc: path.loc.serialize(),
      ref: visit.ref(path.ref),
      tail: path.tail.map(t => t.serialize())
    };
  }

  call(call) {
    return {
      type: 'Call',
      loc: call.loc.serialize(),
      callee: visit.expr(call.callee),
      args: ARGS.args(call.args)
    };
  }

  interpolate(interpolate) {
    return {
      type: 'Interpolate',
      loc: interpolate.loc.serialize(),
      parts: interpolate.parts.map(p => visit.expr(p))
    };
  }

}
const EXPR = new ExprSerializer();

class ArgsSerializer {
  args(args) {
    return {
      loc: args.loc.serialize(),
      positional: this.positional(args.positional),
      named: this.named(args.named)
    };
  }

  positional(positional) {
    return {
      loc: positional.loc.serialize(),
      exprs: positional.exprs.map(p => visit.expr(p))
    };
  }

  named(named) {
    return {
      loc: named.loc.serialize(),
      entries: named.entries.map(e => this.entry(e))
    };
  }

  entry(entry) {
    return [entry.name.serialize(), visit.expr(entry.value)];
  }

}

const ARGS = new ArgsSerializer();
export class ContentSerializer {
  append(node) {
    return {
      type: 'Append',
      loc: node.loc.serialize(),
      value: visit.expr(node.value),
      trusting: node.trusting
    };
  }

  glimmerComment(node) {
    return {
      type: 'GlimmerComment',
      loc: node.loc.serialize(),
      text: node.text.serialize()
    };
  }

  htmlComment(node) {
    return {
      type: 'HtmlComment',
      loc: node.loc.serialize(),
      text: node.text.serialize()
    };
  }

  htmlText(node) {
    return {
      type: 'HtmlText',
      loc: node.loc.serialize(),
      chars: node.chars
    };
  }

  invokeBlock(node) {
    let args = ARGS.args(node.args);
    let callee = visit.expr(node.callee);
    return {
      type: 'InvokeBlock',
      loc: node.loc.serialize(),
      args,
      callee,
      blocks: INTERNAL.namedBlocks(node.blocks)
    };
  }

  invokeComponent(node) {
    return {
      type: 'InvokeComponent',
      loc: node.loc.serialize(),
      callee: visit.expr(node.callee),
      blocks: INTERNAL.namedBlocks(node.blocks),
      attrs: node.attrs.map(a => visit.attr(a)),
      componentArgs: node.componentArgs.map(a => ATTRS.arg(a)),
      modifiers: node.modifiers.map(m => ATTRS.modifier(m))
    };
  }

  simpleElement(node) {
    return {
      type: 'SimpleElement',
      loc: node.loc.serialize(),
      tag: node.tag.serialize(),
      body: node.body.map(b => visit.content(b)),
      attrs: node.attrs.map(a => visit.attr(a)),
      componentArgs: node.componentArgs.map(a => ATTRS.arg(a)),
      modifiers: node.modifiers.map(m => ATTRS.modifier(m))
    };
  }

}
const CONTENT = new ContentSerializer();

class AttrBlockSerializer {
  modifier(node) {
    return {
      loc: node.loc.serialize(),
      callee: visit.expr(node.callee),
      args: ARGS.args(node.args)
    };
  }

  arg(node) {
    return this.anyAttr(node);
  }

  anyAttr(node) {
    return {
      loc: node.loc.serialize(),
      name: node.name.serialize(),
      value: visit.expr(node.value),
      trusting: node.trusting
    };
  }

}

const ATTRS = new AttrBlockSerializer();

class InternalSerializer {
  block(node) {
    return {
      loc: node.loc.serialize(),
      body: node.body.map(b => visit.content(b)),
      table: node.scope.locals
    };
  }

  namedBlock(node) {
    return {
      name: node.name.serialize(),
      block: INTERNAL.block(node.block)
    };
  }

  namedBlocks(node) {
    return {
      blocks: node.blocks.map(b => INTERNAL.namedBlock(b)),
      loc: node.loc.serialize()
    };
  }

}

const INTERNAL = new InternalSerializer();
const visit = {
  expr(expr) {
    switch (expr.type) {
      case 'Literal':
        return EXPR.literal(expr);

      case 'Path':
        return EXPR.path(expr);

      case 'Call':
        return EXPR.call(expr);

      case 'Interpolate':
        return EXPR.interpolate(expr);
    }
  },

  attr(node) {
    if (node.type === 'SplatAttr') {
      return new SourceSlice({
        loc: node.loc,
        chars: '...attributes'
      }).serialize();
    } else {
      return ATTRS.anyAttr(node);
    }
  },

  ref(ref) {
    switch (ref.type) {
      case 'Arg':
        return REF.arg(ref);

      case 'Free':
        return REF.free(ref);

      case 'Local':
        return REF.local(ref);

      case 'This':
        return REF.self(ref);
    }
  },

  content(node) {
    switch (node.type) {
      case 'AppendContent':
        return CONTENT.append(node);

      case 'GlimmerComment':
        return CONTENT.glimmerComment(node);

      case 'HtmlComment':
        return CONTENT.htmlComment(node);

      case 'HtmlText':
        return CONTENT.htmlText(node);

      case 'InvokeBlock':
        return CONTENT.invokeBlock(node);

      case 'InvokeComponent':
        return CONTENT.invokeComponent(node);

      case 'SimpleElement':
        return CONTENT.simpleElement(node);
    }
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvdjItYS9zZXJpYWxpemUvc2VyaWFsaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLFNBQVMsV0FBVCxRQUE0QixvQkFBNUI7QUFpQ0EsT0FBTSxNQUFPLGFBQVAsQ0FBb0I7QUFDeEIsRUFBQSxHQUFHLENBQUMsR0FBRCxFQUF3QjtBQUN6QixXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBQUUsS0FERDtBQUVMLE1BQUEsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFKLENBQVEsU0FBUixFQUZBO0FBR0wsTUFBQSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUosQ0FBUyxTQUFUO0FBSEQsS0FBUDtBQUtEOztBQUVELEVBQUEsSUFBSSxDQUFDLEdBQUQsRUFBNEI7QUFDOUIsV0FBTztBQUNMLE1BQUEsSUFBSSxFQUFFLE1BREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBSixDQUFRLFNBQVIsRUFGQTtBQUdMLE1BQUEsVUFBVSxFQUFFLEdBQUcsQ0FBQyxVQUFKLENBQWUsU0FBZixFQUhQO0FBSUwsTUFBQSxJQUFJLEVBQUUsR0FBRyxDQUFDO0FBSkwsS0FBUDtBQU1EOztBQUVELEVBQUEsS0FBSyxDQUFDLEdBQUQsRUFBNkI7QUFDaEMsV0FBTztBQUNMLE1BQUEsSUFBSSxFQUFFLE9BREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBSixDQUFRLFNBQVIsRUFGQTtBQUdMLE1BQUEsSUFBSSxFQUFFLEdBQUcsQ0FBQztBQUhMLEtBQVA7QUFLRDs7QUFFRCxFQUFBLElBQUksQ0FBQyxHQUFELEVBQXlCO0FBQzNCLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxNQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUosQ0FBUSxTQUFSO0FBRkEsS0FBUDtBQUlEOztBQS9CdUI7QUFrQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksYUFBSixFQUFaO0FBRUEsT0FBTSxNQUFPLGNBQVAsQ0FBcUI7QUFDekIsRUFBQSxPQUFPLENBQUMsT0FBRCxFQUFpQztBQUN0QyxXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBQUUsU0FERDtBQUVMLE1BQUEsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFSLENBQVksU0FBWixFQUZBO0FBR0wsTUFBQSxLQUFLLEVBQUUsT0FBTyxDQUFDO0FBSFYsS0FBUDtBQUtEOztBQUVELEVBQUEsSUFBSSxDQUFDLElBQUQsRUFBMkI7QUFDN0IsV0FBTztBQUNMLE1BQUEsSUFBSSxFQUFFLE1BREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVQsRUFGQTtBQUdMLE1BQUEsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFOLENBQVUsSUFBSSxDQUFDLEdBQWYsQ0FIQTtBQUlMLE1BQUEsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFMLENBQVUsR0FBVixDQUFlLENBQUQsSUFBTyxDQUFDLENBQUMsU0FBRixFQUFyQjtBQUpELEtBQVA7QUFNRDs7QUFFRCxFQUFBLElBQUksQ0FBQyxJQUFELEVBQTJCO0FBQzdCLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxNQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBRkE7QUFHTCxNQUFBLE1BQU0sRUFBRSxLQUFLLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxNQUFoQixDQUhIO0FBSUwsTUFBQSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUwsQ0FBVSxJQUFJLENBQUMsSUFBZjtBQUpELEtBQVA7QUFNRDs7QUFFRCxFQUFBLFdBQVcsQ0FBQyxXQUFELEVBQXlDO0FBQ2xELFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxhQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsV0FBVyxDQUFDLEdBQVosQ0FBZ0IsU0FBaEIsRUFGQTtBQUdMLE1BQUEsS0FBSyxFQUFFLFdBQVcsQ0FBQyxLQUFaLENBQWtCLEdBQWxCLENBQXVCLENBQUQsSUFBTyxLQUFLLENBQUMsSUFBTixDQUFXLENBQVgsQ0FBN0I7QUFIRixLQUFQO0FBS0Q7O0FBakN3QjtBQW9DM0IsTUFBTSxJQUFJLEdBQUcsSUFBSSxjQUFKLEVBQWI7O0FBRUEsTUFBTSxjQUFOLENBQW9CO0FBQ2xCLEVBQUEsSUFBSSxDQUFDLElBQUQsRUFBaUI7QUFDbkIsV0FBTztBQUNMLE1BQUEsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBVCxFQURBO0FBRUwsTUFBQSxVQUFVLEVBQUUsS0FBSyxVQUFMLENBQWdCLElBQUksQ0FBQyxVQUFyQixDQUZQO0FBR0wsTUFBQSxLQUFLLEVBQUUsS0FBSyxLQUFMLENBQVcsSUFBSSxDQUFDLEtBQWhCO0FBSEYsS0FBUDtBQUtEOztBQUVELEVBQUEsVUFBVSxDQUFDLFVBQUQsRUFBc0M7QUFDOUMsV0FBTztBQUNMLE1BQUEsR0FBRyxFQUFFLFVBQVUsQ0FBQyxHQUFYLENBQWUsU0FBZixFQURBO0FBRUwsTUFBQSxLQUFLLEVBQUUsVUFBVSxDQUFDLEtBQVgsQ0FBaUIsR0FBakIsQ0FBc0IsQ0FBRCxJQUFPLEtBQUssQ0FBQyxJQUFOLENBQVcsQ0FBWCxDQUE1QjtBQUZGLEtBQVA7QUFJRDs7QUFFRCxFQUFBLEtBQUssQ0FBQyxLQUFELEVBQTRCO0FBQy9CLFdBQU87QUFDTCxNQUFBLEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBTixDQUFVLFNBQVYsRUFEQTtBQUVMLE1BQUEsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFOLENBQWMsR0FBZCxDQUFtQixDQUFELElBQU8sS0FBSyxLQUFMLENBQVcsQ0FBWCxDQUF6QjtBQUZKLEtBQVA7QUFJRDs7QUFFRCxFQUFBLEtBQUssQ0FBQyxLQUFELEVBQTJCO0FBQzlCLFdBQU8sQ0FBQyxLQUFLLENBQUMsSUFBTixDQUFXLFNBQVgsRUFBRCxFQUF5QixLQUFLLENBQUMsSUFBTixDQUFXLEtBQUssQ0FBQyxLQUFqQixDQUF6QixDQUFQO0FBQ0Q7O0FBekJpQjs7QUE0QnBCLE1BQU0sSUFBSSxHQUFHLElBQUksY0FBSixFQUFiO0FBRUEsT0FBTSxNQUFPLGlCQUFQLENBQXdCO0FBQzVCLEVBQUEsTUFBTSxDQUFDLElBQUQsRUFBMEI7QUFDOUIsV0FBTztBQUNMLE1BQUEsSUFBSSxFQUFFLFFBREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVQsRUFGQTtBQUdMLE1BQUEsS0FBSyxFQUFFLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLEtBQWhCLENBSEY7QUFJTCxNQUFBLFFBQVEsRUFBRSxJQUFJLENBQUM7QUFKVixLQUFQO0FBTUQ7O0FBRUQsRUFBQSxjQUFjLENBQUMsSUFBRCxFQUEyQjtBQUN2QyxXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBQUUsZ0JBREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVQsRUFGQTtBQUdMLE1BQUEsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFMLENBQVUsU0FBVjtBQUhELEtBQVA7QUFLRDs7QUFFRCxFQUFBLFdBQVcsQ0FBQyxJQUFELEVBQXdCO0FBQ2pDLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxhQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBRkE7QUFHTCxNQUFBLElBQUksRUFBRSxJQUFJLENBQUMsSUFBTCxDQUFVLFNBQVY7QUFIRCxLQUFQO0FBS0Q7O0FBRUQsRUFBQSxRQUFRLENBQUMsSUFBRCxFQUFxQjtBQUMzQixXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBQUUsVUFERDtBQUVMLE1BQUEsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBVCxFQUZBO0FBR0wsTUFBQSxLQUFLLEVBQUUsSUFBSSxDQUFDO0FBSFAsS0FBUDtBQUtEOztBQUVELEVBQUEsV0FBVyxDQUFDLElBQUQsRUFBd0I7QUFDakMsUUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUwsQ0FBVSxJQUFJLENBQUMsSUFBZixDQUFYO0FBQ0EsUUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLElBQU4sQ0FBVyxJQUFJLENBQUMsTUFBaEIsQ0FBYjtBQUVBLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxhQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBRkE7QUFHTCxNQUFBLElBSEs7QUFJTCxNQUFBLE1BSks7QUFLTCxNQUFBLE1BQU0sRUFBRSxRQUFRLENBQUMsV0FBVCxDQUFxQixJQUFJLENBQUMsTUFBMUI7QUFMSCxLQUFQO0FBT0Q7O0FBRUQsRUFBQSxlQUFlLENBQUMsSUFBRCxFQUE0QjtBQUN6QyxXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBQUUsaUJBREQ7QUFFTCxNQUFBLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVQsRUFGQTtBQUdMLE1BQUEsTUFBTSxFQUFFLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLE1BQWhCLENBSEg7QUFJTCxNQUFBLE1BQU0sRUFBRSxRQUFRLENBQUMsV0FBVCxDQUFxQixJQUFJLENBQUMsTUFBMUIsQ0FKSDtBQUtMLE1BQUEsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBWCxDQUFnQixDQUFELElBQU8sS0FBSyxDQUFDLElBQU4sQ0FBVyxDQUFYLENBQXRCLENBTEY7QUFNTCxNQUFBLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBTCxDQUFtQixHQUFuQixDQUF3QixDQUFELElBQU8sS0FBSyxDQUFDLEdBQU4sQ0FBVSxDQUFWLENBQTlCLENBTlY7QUFPTCxNQUFBLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBTCxDQUFlLEdBQWYsQ0FBb0IsQ0FBRCxJQUFPLEtBQUssQ0FBQyxRQUFOLENBQWUsQ0FBZixDQUExQjtBQVBOLEtBQVA7QUFTRDs7QUFFRCxFQUFBLGFBQWEsQ0FBQyxJQUFELEVBQTBCO0FBQ3JDLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxlQUREO0FBRUwsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBRkE7QUFHTCxNQUFBLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBTCxDQUFTLFNBQVQsRUFIQTtBQUlMLE1BQUEsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFMLENBQVUsR0FBVixDQUFlLENBQUQsSUFBTyxLQUFLLENBQUMsT0FBTixDQUFjLENBQWQsQ0FBckIsQ0FKRDtBQUtMLE1BQUEsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBWCxDQUFnQixDQUFELElBQU8sS0FBSyxDQUFDLElBQU4sQ0FBVyxDQUFYLENBQXRCLENBTEY7QUFNTCxNQUFBLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBTCxDQUFtQixHQUFuQixDQUF3QixDQUFELElBQU8sS0FBSyxDQUFDLEdBQU4sQ0FBVSxDQUFWLENBQTlCLENBTlY7QUFPTCxNQUFBLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBTCxDQUFlLEdBQWYsQ0FBb0IsQ0FBRCxJQUFPLEtBQUssQ0FBQyxRQUFOLENBQWUsQ0FBZixDQUExQjtBQVBOLEtBQVA7QUFTRDs7QUFyRTJCO0FBd0U5QixNQUFNLE9BQU8sR0FBRyxJQUFJLGlCQUFKLEVBQWhCOztBQUVBLE1BQU0sbUJBQU4sQ0FBeUI7QUFDdkIsRUFBQSxRQUFRLENBQUMsSUFBRCxFQUE0QjtBQUNsQyxXQUFPO0FBQ0wsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBREE7QUFFTCxNQUFBLE1BQU0sRUFBRSxLQUFLLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxNQUFoQixDQUZIO0FBR0wsTUFBQSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUwsQ0FBVSxJQUFJLENBQUMsSUFBZjtBQUhELEtBQVA7QUFLRDs7QUFFRCxFQUFBLEdBQUcsQ0FBQyxJQUFELEVBQXlCO0FBQzFCLFdBQU8sS0FBSyxPQUFMLENBQWEsSUFBYixDQUFQO0FBQ0Q7O0FBRUQsRUFBQSxPQUFPLENBQUMsSUFBRCxFQUEwQztBQUMvQyxXQUFPO0FBQ0wsTUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFULEVBREE7QUFFTCxNQUFBLElBQUksRUFBRSxJQUFJLENBQUMsSUFBTCxDQUFVLFNBQVYsRUFGRDtBQUdMLE1BQUEsS0FBSyxFQUFFLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLEtBQWhCLENBSEY7QUFJTCxNQUFBLFFBQVEsRUFBRSxJQUFJLENBQUM7QUFKVixLQUFQO0FBTUQ7O0FBcEJzQjs7QUF1QnpCLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUosRUFBZDs7QUFFQSxNQUFNLGtCQUFOLENBQXdCO0FBQ3RCLEVBQUEsS0FBSyxDQUFDLElBQUQsRUFBa0I7QUFDckIsV0FBTztBQUNMLE1BQUEsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBVCxFQURBO0FBRUwsTUFBQSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUwsQ0FBVSxHQUFWLENBQWUsQ0FBRCxJQUFPLEtBQUssQ0FBQyxPQUFOLENBQWMsQ0FBZCxDQUFyQixDQUZEO0FBR0wsTUFBQSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUwsQ0FBVztBQUhiLEtBQVA7QUFLRDs7QUFFRCxFQUFBLFVBQVUsQ0FBQyxJQUFELEVBQXVCO0FBQy9CLFdBQU87QUFDTCxNQUFBLElBQUksRUFBRSxJQUFJLENBQUMsSUFBTCxDQUFVLFNBQVYsRUFERDtBQUVMLE1BQUEsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFULENBQWUsSUFBSSxDQUFDLEtBQXBCO0FBRkYsS0FBUDtBQUlEOztBQUVELEVBQUEsV0FBVyxDQUFDLElBQUQsRUFBd0I7QUFDakMsV0FBTztBQUNMLE1BQUEsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFMLENBQVksR0FBWixDQUFpQixDQUFELElBQU8sUUFBUSxDQUFDLFVBQVQsQ0FBb0IsQ0FBcEIsQ0FBdkIsQ0FESDtBQUVMLE1BQUEsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFMLENBQVMsU0FBVDtBQUZBLEtBQVA7QUFJRDs7QUFyQnFCOztBQXdCeEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxrQkFBSixFQUFqQjtBQUVBLE1BQU0sS0FBSyxHQUFHO0FBQ1osRUFBQSxJQUFJLENBQUMsSUFBRCxFQUEyQjtBQUM3QixZQUFRLElBQUksQ0FBQyxJQUFiO0FBQ0UsV0FBSyxTQUFMO0FBQ0UsZUFBTyxJQUFJLENBQUMsT0FBTCxDQUFhLElBQWIsQ0FBUDs7QUFDRixXQUFLLE1BQUw7QUFDRSxlQUFPLElBQUksQ0FBQyxJQUFMLENBQVUsSUFBVixDQUFQOztBQUNGLFdBQUssTUFBTDtBQUNFLGVBQU8sSUFBSSxDQUFDLElBQUwsQ0FBVSxJQUFWLENBQVA7O0FBQ0YsV0FBSyxhQUFMO0FBQ0UsZUFBTyxJQUFJLENBQUMsV0FBTCxDQUFpQixJQUFqQixDQUFQO0FBUko7QUFVRCxHQVpXOztBQWNaLEVBQUEsSUFBSSxDQUFDLElBQUQsRUFBNEI7QUFDOUIsUUFBSSxJQUFJLENBQUMsSUFBTCxLQUFjLFdBQWxCLEVBQStCO0FBQzdCLGFBQU8sSUFBSSxXQUFKLENBQWdCO0FBQUUsUUFBQSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQVo7QUFBaUIsUUFBQSxLQUFLLEVBQUU7QUFBeEIsT0FBaEIsRUFBMkQsU0FBM0QsRUFBUDtBQUNELEtBRkQsTUFFTztBQUNMLGFBQU8sS0FBSyxDQUFDLE9BQU4sQ0FBYyxJQUFkLENBQVA7QUFDRDtBQUNGLEdBcEJXOztBQXNCWixFQUFBLEdBQUcsQ0FBQyxHQUFELEVBQTZCO0FBQzlCLFlBQVEsR0FBRyxDQUFDLElBQVo7QUFDRSxXQUFLLEtBQUw7QUFDRSxlQUFPLEdBQUcsQ0FBQyxHQUFKLENBQVEsR0FBUixDQUFQOztBQUNGLFdBQUssTUFBTDtBQUNFLGVBQU8sR0FBRyxDQUFDLElBQUosQ0FBUyxHQUFULENBQVA7O0FBQ0YsV0FBSyxPQUFMO0FBQ0UsZUFBTyxHQUFHLENBQUMsS0FBSixDQUFVLEdBQVYsQ0FBUDs7QUFDRixXQUFLLE1BQUw7QUFDRSxlQUFPLEdBQUcsQ0FBQyxJQUFKLENBQVMsR0FBVCxDQUFQO0FBUko7QUFVRCxHQWpDVzs7QUFtQ1osRUFBQSxPQUFPLENBQUMsSUFBRCxFQUF3QjtBQUM3QixZQUFRLElBQUksQ0FBQyxJQUFiO0FBQ0UsV0FBSyxlQUFMO0FBQ0UsZUFBTyxPQUFPLENBQUMsTUFBUixDQUFlLElBQWYsQ0FBUDs7QUFDRixXQUFLLGdCQUFMO0FBQ0UsZUFBTyxPQUFPLENBQUMsY0FBUixDQUF1QixJQUF2QixDQUFQOztBQUNGLFdBQUssYUFBTDtBQUNFLGVBQU8sT0FBTyxDQUFDLFdBQVIsQ0FBb0IsSUFBcEIsQ0FBUDs7QUFDRixXQUFLLFVBQUw7QUFDRSxlQUFPLE9BQU8sQ0FBQyxRQUFSLENBQWlCLElBQWpCLENBQVA7O0FBQ0YsV0FBSyxhQUFMO0FBQ0UsZUFBTyxPQUFPLENBQUMsV0FBUixDQUFvQixJQUFwQixDQUFQOztBQUNGLFdBQUssaUJBQUw7QUFDRSxlQUFPLE9BQU8sQ0FBQyxlQUFSLENBQXdCLElBQXhCLENBQVA7O0FBQ0YsV0FBSyxlQUFMO0FBQ0UsZUFBTyxPQUFPLENBQUMsYUFBUixDQUFzQixJQUF0QixDQUFQO0FBZEo7QUFnQkQ7O0FBcERXLENBQWQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmVzZW50QXJyYXkgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcblxuaW1wb3J0IHsgU291cmNlU2xpY2UgfSBmcm9tICcuLi8uLi9zb3VyY2Uvc2xpY2UnO1xuaW1wb3J0ICogYXMgQVNUdjIgZnJvbSAnLi4vYXBpJztcbmltcG9ydCB0eXBlIHtcbiAgU2VyaWFsaXplZEFwcGVuZENvbnRlbnQsXG4gIFNlcmlhbGl6ZWRBcmdSZWZlcmVuY2UsXG4gIFNlcmlhbGl6ZWRBcmdzLFxuICBTZXJpYWxpemVkQXR0ck9yQXJnLFxuICBTZXJpYWxpemVkQmxvY2ssXG4gIFNlcmlhbGl6ZWRDYWxsRXhwcmVzc2lvbixcbiAgU2VyaWFsaXplZENvbnRlbnROb2RlLFxuICBTZXJpYWxpemVkRWxlbWVudE1vZGlmaWVyLFxuICBTZXJpYWxpemVkRXhwcmVzc2lvbk5vZGUsXG4gIFNlcmlhbGl6ZWRGcmVlVmFyUmVmZXJlbmNlLFxuICBTZXJpYWxpemVkR2xpbW1lckNvbW1lbnQsXG4gIFNlcmlhbGl6ZWRIdG1sQ29tbWVudCxcbiAgU2VyaWFsaXplZEh0bWxPclNwbGF0QXR0cixcbiAgU2VyaWFsaXplZEh0bWxUZXh0LFxuICBTZXJpYWxpemVkSW50ZXJwb2xhdGVFeHByZXNzaW9uLFxuICBTZXJpYWxpemVkSW52b2tlQmxvY2ssXG4gIFNlcmlhbGl6ZWRJbnZva2VDb21wb25lbnQsXG4gIFNlcmlhbGl6ZWRMaXRlcmFsRXhwcmVzc2lvbixcbiAgU2VyaWFsaXplZExvY2FsVmFyUmVmZXJlbmNlLFxuICBTZXJpYWxpemVkTmFtZWQsXG4gIFNlcmlhbGl6ZWROYW1lZEFyZ3VtZW50LFxuICBTZXJpYWxpemVkTmFtZWRCbG9jayxcbiAgU2VyaWFsaXplZE5hbWVkQmxvY2tzLFxuICBTZXJpYWxpemVkUGF0aEV4cHJlc3Npb24sXG4gIFNlcmlhbGl6ZWRQb3NpdGlvbmFsLFxuICBTZXJpYWxpemVkU2ltcGxlRWxlbWVudCxcbiAgU2VyaWFsaXplZFRoaXNSZWZlcmVuY2UsXG4gIFNlcmlhbGl6ZWRWYXJpYWJsZVJlZmVyZW5jZSxcbn0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBSZWZTZXJpYWxpemVyIHtcbiAgYXJnKHJlZjogQVNUdjIuQXJnUmVmZXJlbmNlKTogU2VyaWFsaXplZEFyZ1JlZmVyZW5jZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdBcmcnLFxuICAgICAgbG9jOiByZWYubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgbmFtZTogcmVmLm5hbWUuc2VyaWFsaXplKCksXG4gICAgfTtcbiAgfVxuXG4gIGZyZWUocmVmOiBBU1R2Mi5GcmVlVmFyUmVmZXJlbmNlKTogU2VyaWFsaXplZEZyZWVWYXJSZWZlcmVuY2Uge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnRnJlZScsXG4gICAgICBsb2M6IHJlZi5sb2Muc2VyaWFsaXplKCksXG4gICAgICByZXNvbHV0aW9uOiByZWYucmVzb2x1dGlvbi5zZXJpYWxpemUoKSxcbiAgICAgIG5hbWU6IHJlZi5uYW1lLFxuICAgIH07XG4gIH1cblxuICBsb2NhbChyZWY6IEFTVHYyLkxvY2FsVmFyUmVmZXJlbmNlKTogU2VyaWFsaXplZExvY2FsVmFyUmVmZXJlbmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0xvY2FsJyxcbiAgICAgIGxvYzogcmVmLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIG5hbWU6IHJlZi5uYW1lLFxuICAgIH07XG4gIH1cblxuICBzZWxmKHJlZjogQVNUdjIuVGhpc1JlZmVyZW5jZSk6IFNlcmlhbGl6ZWRUaGlzUmVmZXJlbmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ1RoaXMnLFxuICAgICAgbG9jOiByZWYubG9jLnNlcmlhbGl6ZSgpLFxuICAgIH07XG4gIH1cbn1cblxuY29uc3QgUkVGID0gbmV3IFJlZlNlcmlhbGl6ZXIoKTtcblxuZXhwb3J0IGNsYXNzIEV4cHJTZXJpYWxpemVyIHtcbiAgbGl0ZXJhbChsaXRlcmFsOiBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbik6IFNlcmlhbGl6ZWRMaXRlcmFsRXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdMaXRlcmFsJyxcbiAgICAgIGxvYzogbGl0ZXJhbC5sb2Muc2VyaWFsaXplKCksXG4gICAgICB2YWx1ZTogbGl0ZXJhbC52YWx1ZSxcbiAgICB9O1xuICB9XG5cbiAgcGF0aChwYXRoOiBBU1R2Mi5QYXRoRXhwcmVzc2lvbik6IFNlcmlhbGl6ZWRQYXRoRXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdQYXRoJyxcbiAgICAgIGxvYzogcGF0aC5sb2Muc2VyaWFsaXplKCksXG4gICAgICByZWY6IHZpc2l0LnJlZihwYXRoLnJlZiksXG4gICAgICB0YWlsOiBwYXRoLnRhaWwubWFwKCh0KSA9PiB0LnNlcmlhbGl6ZSgpKSxcbiAgICB9O1xuICB9XG5cbiAgY2FsbChjYWxsOiBBU1R2Mi5DYWxsRXhwcmVzc2lvbik6IFNlcmlhbGl6ZWRDYWxsRXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdDYWxsJyxcbiAgICAgIGxvYzogY2FsbC5sb2Muc2VyaWFsaXplKCksXG4gICAgICBjYWxsZWU6IHZpc2l0LmV4cHIoY2FsbC5jYWxsZWUpLFxuICAgICAgYXJnczogQVJHUy5hcmdzKGNhbGwuYXJncyksXG4gICAgfTtcbiAgfVxuXG4gIGludGVycG9sYXRlKGludGVycG9sYXRlOiBBU1R2Mi5JbnRlcnBvbGF0ZUV4cHJlc3Npb24pOiBTZXJpYWxpemVkSW50ZXJwb2xhdGVFeHByZXNzaW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0ludGVycG9sYXRlJyxcbiAgICAgIGxvYzogaW50ZXJwb2xhdGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgcGFydHM6IGludGVycG9sYXRlLnBhcnRzLm1hcCgocCkgPT4gdmlzaXQuZXhwcihwKSkgYXMgUHJlc2VudEFycmF5PFNlcmlhbGl6ZWRFeHByZXNzaW9uTm9kZT4sXG4gICAgfTtcbiAgfVxufVxuXG5jb25zdCBFWFBSID0gbmV3IEV4cHJTZXJpYWxpemVyKCk7XG5cbmNsYXNzIEFyZ3NTZXJpYWxpemVyIHtcbiAgYXJncyhhcmdzOiBBU1R2Mi5BcmdzKTogU2VyaWFsaXplZEFyZ3Mge1xuICAgIHJldHVybiB7XG4gICAgICBsb2M6IGFyZ3MubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgcG9zaXRpb25hbDogdGhpcy5wb3NpdGlvbmFsKGFyZ3MucG9zaXRpb25hbCksXG4gICAgICBuYW1lZDogdGhpcy5uYW1lZChhcmdzLm5hbWVkKSxcbiAgICB9O1xuICB9XG5cbiAgcG9zaXRpb25hbChwb3NpdGlvbmFsOiBBU1R2Mi5Qb3NpdGlvbmFsQXJndW1lbnRzKTogU2VyaWFsaXplZFBvc2l0aW9uYWwge1xuICAgIHJldHVybiB7XG4gICAgICBsb2M6IHBvc2l0aW9uYWwubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgZXhwcnM6IHBvc2l0aW9uYWwuZXhwcnMubWFwKChwKSA9PiB2aXNpdC5leHByKHApKSxcbiAgICB9O1xuICB9XG5cbiAgbmFtZWQobmFtZWQ6IEFTVHYyLk5hbWVkQXJndW1lbnRzKTogU2VyaWFsaXplZE5hbWVkIHtcbiAgICByZXR1cm4ge1xuICAgICAgbG9jOiBuYW1lZC5sb2Muc2VyaWFsaXplKCksXG4gICAgICBlbnRyaWVzOiBuYW1lZC5lbnRyaWVzLm1hcCgoZSkgPT4gdGhpcy5lbnRyeShlKSksXG4gICAgfTtcbiAgfVxuXG4gIGVudHJ5KGVudHJ5OiBBU1R2Mi5OYW1lZEFyZ3VtZW50KTogU2VyaWFsaXplZE5hbWVkQXJndW1lbnQge1xuICAgIHJldHVybiBbZW50cnkubmFtZS5zZXJpYWxpemUoKSwgdmlzaXQuZXhwcihlbnRyeS52YWx1ZSldO1xuICB9XG59XG5cbmNvbnN0IEFSR1MgPSBuZXcgQXJnc1NlcmlhbGl6ZXIoKTtcblxuZXhwb3J0IGNsYXNzIENvbnRlbnRTZXJpYWxpemVyIHtcbiAgYXBwZW5kKG5vZGU6IEFTVHYyLkFwcGVuZENvbnRlbnQpOiBTZXJpYWxpemVkQXBwZW5kQ29udGVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdBcHBlbmQnLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHZhbHVlOiB2aXNpdC5leHByKG5vZGUudmFsdWUpLFxuICAgICAgdHJ1c3Rpbmc6IG5vZGUudHJ1c3RpbmcsXG4gICAgfTtcbiAgfVxuXG4gIGdsaW1tZXJDb21tZW50KG5vZGU6IEFTVHYyLkdsaW1tZXJDb21tZW50KTogU2VyaWFsaXplZEdsaW1tZXJDb21tZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0dsaW1tZXJDb21tZW50JyxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICB0ZXh0OiBub2RlLnRleHQuc2VyaWFsaXplKCksXG4gICAgfTtcbiAgfVxuXG4gIGh0bWxDb21tZW50KG5vZGU6IEFTVHYyLkh0bWxDb21tZW50KTogU2VyaWFsaXplZEh0bWxDb21tZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0h0bWxDb21tZW50JyxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICB0ZXh0OiBub2RlLnRleHQuc2VyaWFsaXplKCksXG4gICAgfTtcbiAgfVxuXG4gIGh0bWxUZXh0KG5vZGU6IEFTVHYyLkh0bWxUZXh0KTogU2VyaWFsaXplZEh0bWxUZXh0IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0h0bWxUZXh0JyxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBjaGFyczogbm9kZS5jaGFycyxcbiAgICB9O1xuICB9XG5cbiAgaW52b2tlQmxvY2sobm9kZTogQVNUdjIuSW52b2tlQmxvY2spOiBTZXJpYWxpemVkSW52b2tlQmxvY2sge1xuICAgIGxldCBhcmdzID0gQVJHUy5hcmdzKG5vZGUuYXJncyk7XG4gICAgbGV0IGNhbGxlZSA9IHZpc2l0LmV4cHIobm9kZS5jYWxsZWUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdJbnZva2VCbG9jaycsXG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgYXJncyxcbiAgICAgIGNhbGxlZSxcbiAgICAgIGJsb2NrczogSU5URVJOQUwubmFtZWRCbG9ja3Mobm9kZS5ibG9ja3MpLFxuICAgIH07XG4gIH1cblxuICBpbnZva2VDb21wb25lbnQobm9kZTogQVNUdjIuSW52b2tlQ29tcG9uZW50KTogU2VyaWFsaXplZEludm9rZUNvbXBvbmVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdJbnZva2VDb21wb25lbnQnLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIGNhbGxlZTogdmlzaXQuZXhwcihub2RlLmNhbGxlZSksXG4gICAgICBibG9ja3M6IElOVEVSTkFMLm5hbWVkQmxvY2tzKG5vZGUuYmxvY2tzKSxcbiAgICAgIGF0dHJzOiBub2RlLmF0dHJzLm1hcCgoYSkgPT4gdmlzaXQuYXR0cihhKSksXG4gICAgICBjb21wb25lbnRBcmdzOiBub2RlLmNvbXBvbmVudEFyZ3MubWFwKChhKSA9PiBBVFRSUy5hcmcoYSkpLFxuICAgICAgbW9kaWZpZXJzOiBub2RlLm1vZGlmaWVycy5tYXAoKG0pID0+IEFUVFJTLm1vZGlmaWVyKG0pKSxcbiAgICB9O1xuICB9XG5cbiAgc2ltcGxlRWxlbWVudChub2RlOiBBU1R2Mi5TaW1wbGVFbGVtZW50KTogU2VyaWFsaXplZFNpbXBsZUVsZW1lbnQge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnU2ltcGxlRWxlbWVudCcsXG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgdGFnOiBub2RlLnRhZy5zZXJpYWxpemUoKSxcbiAgICAgIGJvZHk6IG5vZGUuYm9keS5tYXAoKGIpID0+IHZpc2l0LmNvbnRlbnQoYikpLFxuICAgICAgYXR0cnM6IG5vZGUuYXR0cnMubWFwKChhKSA9PiB2aXNpdC5hdHRyKGEpKSxcbiAgICAgIGNvbXBvbmVudEFyZ3M6IG5vZGUuY29tcG9uZW50QXJncy5tYXAoKGEpID0+IEFUVFJTLmFyZyhhKSksXG4gICAgICBtb2RpZmllcnM6IG5vZGUubW9kaWZpZXJzLm1hcCgobSkgPT4gQVRUUlMubW9kaWZpZXIobSkpLFxuICAgIH07XG4gIH1cbn1cblxuY29uc3QgQ09OVEVOVCA9IG5ldyBDb250ZW50U2VyaWFsaXplcigpO1xuXG5jbGFzcyBBdHRyQmxvY2tTZXJpYWxpemVyIHtcbiAgbW9kaWZpZXIobm9kZTogQVNUdjIuRWxlbWVudE1vZGlmaWVyKTogU2VyaWFsaXplZEVsZW1lbnRNb2RpZmllciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBjYWxsZWU6IHZpc2l0LmV4cHIobm9kZS5jYWxsZWUpLFxuICAgICAgYXJnczogQVJHUy5hcmdzKG5vZGUuYXJncyksXG4gICAgfTtcbiAgfVxuXG4gIGFyZyhub2RlOiBBU1R2Mi5Db21wb25lbnRBcmcpOiBTZXJpYWxpemVkQXR0ck9yQXJnIHtcbiAgICByZXR1cm4gdGhpcy5hbnlBdHRyKG5vZGUpO1xuICB9XG5cbiAgYW55QXR0cihub2RlOiBBU1R2Mi5Db21wb25lbnRBcmcgfCBBU1R2Mi5IdG1sQXR0cik6IFNlcmlhbGl6ZWRBdHRyT3JBcmcge1xuICAgIHJldHVybiB7XG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgbmFtZTogbm9kZS5uYW1lLnNlcmlhbGl6ZSgpLFxuICAgICAgdmFsdWU6IHZpc2l0LmV4cHIobm9kZS52YWx1ZSksXG4gICAgICB0cnVzdGluZzogbm9kZS50cnVzdGluZyxcbiAgICB9O1xuICB9XG59XG5cbmNvbnN0IEFUVFJTID0gbmV3IEF0dHJCbG9ja1NlcmlhbGl6ZXIoKTtcblxuY2xhc3MgSW50ZXJuYWxTZXJpYWxpemVyIHtcbiAgYmxvY2sobm9kZTogQVNUdjIuQmxvY2spOiBTZXJpYWxpemVkQmxvY2sge1xuICAgIHJldHVybiB7XG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgYm9keTogbm9kZS5ib2R5Lm1hcCgoYikgPT4gdmlzaXQuY29udGVudChiKSksXG4gICAgICB0YWJsZTogbm9kZS5zY29wZS5sb2NhbHMsXG4gICAgfTtcbiAgfVxuXG4gIG5hbWVkQmxvY2sobm9kZTogQVNUdjIuTmFtZWRCbG9jayk6IFNlcmlhbGl6ZWROYW1lZEJsb2NrIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogbm9kZS5uYW1lLnNlcmlhbGl6ZSgpLFxuICAgICAgYmxvY2s6IElOVEVSTkFMLmJsb2NrKG5vZGUuYmxvY2spLFxuICAgIH07XG4gIH1cblxuICBuYW1lZEJsb2Nrcyhub2RlOiBBU1R2Mi5OYW1lZEJsb2Nrcyk6IFNlcmlhbGl6ZWROYW1lZEJsb2NrcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJsb2Nrczogbm9kZS5ibG9ja3MubWFwKChiKSA9PiBJTlRFUk5BTC5uYW1lZEJsb2NrKGIpKSxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgfTtcbiAgfVxufVxuXG5jb25zdCBJTlRFUk5BTCA9IG5ldyBJbnRlcm5hbFNlcmlhbGl6ZXIoKTtcblxuY29uc3QgdmlzaXQgPSB7XG4gIGV4cHIoZXhwcjogQVNUdjIuRXhwcmVzc2lvbk5vZGUpOiBTZXJpYWxpemVkRXhwcmVzc2lvbk5vZGUge1xuICAgIHN3aXRjaCAoZXhwci50eXBlKSB7XG4gICAgICBjYXNlICdMaXRlcmFsJzpcbiAgICAgICAgcmV0dXJuIEVYUFIubGl0ZXJhbChleHByKTtcbiAgICAgIGNhc2UgJ1BhdGgnOlxuICAgICAgICByZXR1cm4gRVhQUi5wYXRoKGV4cHIpO1xuICAgICAgY2FzZSAnQ2FsbCc6XG4gICAgICAgIHJldHVybiBFWFBSLmNhbGwoZXhwcik7XG4gICAgICBjYXNlICdJbnRlcnBvbGF0ZSc6XG4gICAgICAgIHJldHVybiBFWFBSLmludGVycG9sYXRlKGV4cHIpO1xuICAgIH1cbiAgfSxcblxuICBhdHRyKG5vZGU6IEFTVHYyLkh0bWxPclNwbGF0QXR0cik6IFNlcmlhbGl6ZWRIdG1sT3JTcGxhdEF0dHIge1xuICAgIGlmIChub2RlLnR5cGUgPT09ICdTcGxhdEF0dHInKSB7XG4gICAgICByZXR1cm4gbmV3IFNvdXJjZVNsaWNlKHsgbG9jOiBub2RlLmxvYywgY2hhcnM6ICcuLi5hdHRyaWJ1dGVzJyB9KS5zZXJpYWxpemUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIEFUVFJTLmFueUF0dHIobm9kZSk7XG4gICAgfVxuICB9LFxuXG4gIHJlZihyZWY6IEFTVHYyLlZhcmlhYmxlUmVmZXJlbmNlKTogU2VyaWFsaXplZFZhcmlhYmxlUmVmZXJlbmNlIHtcbiAgICBzd2l0Y2ggKHJlZi50eXBlKSB7XG4gICAgICBjYXNlICdBcmcnOlxuICAgICAgICByZXR1cm4gUkVGLmFyZyhyZWYpO1xuICAgICAgY2FzZSAnRnJlZSc6XG4gICAgICAgIHJldHVybiBSRUYuZnJlZShyZWYpO1xuICAgICAgY2FzZSAnTG9jYWwnOlxuICAgICAgICByZXR1cm4gUkVGLmxvY2FsKHJlZik7XG4gICAgICBjYXNlICdUaGlzJzpcbiAgICAgICAgcmV0dXJuIFJFRi5zZWxmKHJlZik7XG4gICAgfVxuICB9LFxuXG4gIGNvbnRlbnQobm9kZTogQVNUdjIuQ29udGVudE5vZGUpOiBTZXJpYWxpemVkQ29udGVudE5vZGUge1xuICAgIHN3aXRjaCAobm9kZS50eXBlKSB7XG4gICAgICBjYXNlICdBcHBlbmRDb250ZW50JzpcbiAgICAgICAgcmV0dXJuIENPTlRFTlQuYXBwZW5kKG5vZGUpO1xuICAgICAgY2FzZSAnR2xpbW1lckNvbW1lbnQnOlxuICAgICAgICByZXR1cm4gQ09OVEVOVC5nbGltbWVyQ29tbWVudChub2RlKTtcbiAgICAgIGNhc2UgJ0h0bWxDb21tZW50JzpcbiAgICAgICAgcmV0dXJuIENPTlRFTlQuaHRtbENvbW1lbnQobm9kZSk7XG4gICAgICBjYXNlICdIdG1sVGV4dCc6XG4gICAgICAgIHJldHVybiBDT05URU5ULmh0bWxUZXh0KG5vZGUpO1xuICAgICAgY2FzZSAnSW52b2tlQmxvY2snOlxuICAgICAgICByZXR1cm4gQ09OVEVOVC5pbnZva2VCbG9jayhub2RlKTtcbiAgICAgIGNhc2UgJ0ludm9rZUNvbXBvbmVudCc6XG4gICAgICAgIHJldHVybiBDT05URU5ULmludm9rZUNvbXBvbmVudChub2RlKTtcbiAgICAgIGNhc2UgJ1NpbXBsZUVsZW1lbnQnOlxuICAgICAgICByZXR1cm4gQ09OVEVOVC5zaW1wbGVFbGVtZW50KG5vZGUpO1xuICAgIH1cbiAgfSxcbn07XG4iXSwic291cmNlUm9vdCI6IiJ9