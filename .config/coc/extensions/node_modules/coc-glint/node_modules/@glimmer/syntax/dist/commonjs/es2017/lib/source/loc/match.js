"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.match = match;
exports.IsInvisible = exports.MatchAny = void 0;

var _util = require("@glimmer/util");

var __classPrivateFieldSet = void 0 && (void 0).__classPrivateFieldSet || function (receiver, privateMap, value) {
  if (!privateMap.has(receiver)) {
    throw new TypeError("attempted to set private field on non-instance");
  }

  privateMap.set(receiver, value);
  return value;
};

var __classPrivateFieldGet = void 0 && (void 0).__classPrivateFieldGet || function (receiver, privateMap) {
  if (!privateMap.has(receiver)) {
    throw new TypeError("attempted to get private field on non-instance");
  }

  return privateMap.get(receiver);
};

var _whens, _map, _whens_1;

/**
 * This file implements the DSL used by span and offset in places where they need to exhaustively
 * consider all combinations of states (Handlebars offsets, character offsets and invisible/broken
 * offsets).
 *
 * It's probably overkill, but it makes the code that uses it clear. It could be refactored or
 * removed.
 */
const MatchAny = 'MATCH_ANY';
exports.MatchAny = MatchAny;
const IsInvisible = 'IS_INVISIBLE';
exports.IsInvisible = IsInvisible;

class WhenList {
  constructor(whens) {
    _whens.set(this, void 0);

    __classPrivateFieldSet(this, _whens, whens);
  }

  first(kind) {
    for (let when of __classPrivateFieldGet(this, _whens)) {
      let value = when.match(kind);

      if ((0, _util.isPresent)(value)) {
        return value[0];
      }
    }

    return null;
  }

}

_whens = new WeakMap();

class When {
  constructor() {
    _map.set(this, new Map());
  }

  get(pattern, or) {
    let value = __classPrivateFieldGet(this, _map).get(pattern);

    if (value) {
      return value;
    }

    value = or();

    __classPrivateFieldGet(this, _map).set(pattern, value);

    return value;
  }

  add(pattern, out) {
    __classPrivateFieldGet(this, _map).set(pattern, out);
  }

  match(kind) {
    let pattern = patternFor(kind);
    let out = [];

    let exact = __classPrivateFieldGet(this, _map).get(pattern);

    let fallback = __classPrivateFieldGet(this, _map).get(MatchAny);

    if (exact) {
      out.push(exact);
    }

    if (fallback) {
      out.push(fallback);
    }

    return out;
  }

}

_map = new WeakMap();

function match(callback) {
  return callback(new Matcher()).check();
}

class Matcher {
  constructor() {
    _whens_1.set(this, new When());
  }
  /**
   * You didn't exhaustively match all possibilities.
   */


  check() {
    return (left, right) => this.matchFor(left.kind, right.kind)(left, right);
  }

  matchFor(left, right) {
    let nesteds = __classPrivateFieldGet(this, _whens_1).match(left);

    false && (0, _util.assert)((0, _util.isPresent)(nesteds), `no match defined for (${left}, ${right}) and no AnyMatch defined either`);
    let callback = new WhenList(nesteds).first(right);
    false && (0, _util.assert)(callback !== null, `no match defined for (${left}, ${right}) and no AnyMatch defined either`);
    return callback;
  }

  when(left, right, // eslint-disable-next-line @typescript-eslint/no-explicit-any
  callback) {
    __classPrivateFieldGet(this, _whens_1).get(left, () => new When()).add(right, callback);

    return this;
  }

}

_whens_1 = new WeakMap();

function patternFor(kind) {
  switch (kind) {
    case "Broken"
    /* Broken */
    :
    case "InternalsSynthetic"
    /* InternalsSynthetic */
    :
    case "NonExistent"
    /* NonExistent */
    :
      return IsInvisible;

    default:
      return kind;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvc291cmNlL2xvYy9tYXRjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJQTs7Ozs7Ozs7QUFTTyxNQUFNLFFBQVEsR0FBZCxXQUFBOztBQVdBLE1BQU0sV0FBVyxHQUFqQixjQUFBOzs7QUFLUCxNQUFBLFFBQUEsQ0FBYztBQUdaLEVBQUEsV0FBQSxDQUFBLEtBQUEsRUFBOEI7QUFGOUIsSUFBQSxNQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsRUFBQSxLQUFBLENBQUE7O0FBR0UsSUFBQSxzQkFBQSxDQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxDQUFBO0FBQ0Q7O0FBRUQsRUFBQSxLQUFLLENBQUEsSUFBQSxFQUFpQjtBQUNwQixTQUFLLElBQUwsSUFBQSxJQUFhLHNCQUFBLENBQUEsSUFBQSxFQUFiLE1BQWEsQ0FBYixFQUE4QjtBQUM1QixVQUFJLEtBQUssR0FBRyxJQUFJLENBQUosS0FBQSxDQUFaLElBQVksQ0FBWjs7QUFDQSxVQUFJLHFCQUFKLEtBQUksQ0FBSixFQUFzQjtBQUNwQixlQUFPLEtBQUssQ0FBWixDQUFZLENBQVo7QUFDRDtBQUNGOztBQUVELFdBQUEsSUFBQTtBQUNEOztBQWhCVzs7OztBQW1CZCxNQUFBLElBQUEsQ0FBVTtBQUFWLEVBQUEsV0FBQSxHQUFBO0FBQ0UsSUFBQSxJQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsRUFBMEIsSUFBMUIsR0FBMEIsRUFBMUI7QUFzQ0Q7O0FBcENDLEVBQUEsR0FBRyxDQUFBLE9BQUEsRUFBQSxFQUFBLEVBQWdDO0FBQ2pDLFFBQUksS0FBSyxHQUFHLHNCQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBWixPQUFZLENBQVo7O0FBRUEsUUFBQSxLQUFBLEVBQVc7QUFDVCxhQUFBLEtBQUE7QUFDRDs7QUFFRCxJQUFBLEtBQUssR0FBRyxFQUFSLEVBQUE7O0FBRUEsSUFBQSxzQkFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsT0FBQSxFQUFBLEtBQUE7O0FBRUEsV0FBQSxLQUFBO0FBQ0Q7O0FBRUQsRUFBQSxHQUFHLENBQUEsT0FBQSxFQUFBLEdBQUEsRUFBMkI7QUFDNUIsSUFBQSxzQkFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsT0FBQSxFQUFBLEdBQUE7QUFDRDs7QUFFRCxFQUFBLEtBQUssQ0FBQSxJQUFBLEVBQWlCO0FBQ3BCLFFBQUksT0FBTyxHQUFHLFVBQVUsQ0FBeEIsSUFBd0IsQ0FBeEI7QUFFQSxRQUFJLEdBQUcsR0FBUCxFQUFBOztBQUVBLFFBQUksS0FBSyxHQUFHLHNCQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBWixPQUFZLENBQVo7O0FBQ0EsUUFBSSxRQUFRLEdBQUcsc0JBQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsR0FBQSxDQUFmLFFBQWUsQ0FBZjs7QUFFQSxRQUFBLEtBQUEsRUFBVztBQUNULE1BQUEsR0FBRyxDQUFILElBQUEsQ0FBQSxLQUFBO0FBQ0Q7O0FBRUQsUUFBQSxRQUFBLEVBQWM7QUFDWixNQUFBLEdBQUcsQ0FBSCxJQUFBLENBQUEsUUFBQTtBQUNEOztBQUVELFdBQUEsR0FBQTtBQUNEOztBQXRDTzs7OztBQXNESixTQUFBLEtBQUEsQ0FBQSxRQUFBLEVBQTBFO0FBQzlFLFNBQU8sUUFBUSxDQUFDLElBQVQsT0FBUyxFQUFELENBQVIsQ0FBUCxLQUFPLEVBQVA7QUFDRDs7QUFFRCxNQUFBLE9BQUEsQ0FBYTtBQUFiLEVBQUEsV0FBQSxHQUFBO0FBQ0UsSUFBQSxRQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsRUFBdUUsSUFBdkUsSUFBdUUsRUFBdkU7QUE4RUQ7QUE1RUM7Ozs7O0FBR1UsRUFBQSxLQUFLLEdBQUE7QUFDYixXQUFPLENBQUEsSUFBQSxFQUFBLEtBQUEsS0FBaUIsS0FBQSxRQUFBLENBQWMsSUFBSSxDQUFsQixJQUFBLEVBQXlCLEtBQUssQ0FBOUIsSUFBQSxFQUFBLElBQUEsRUFBeEIsS0FBd0IsQ0FBeEI7QUFDRDs7QUFFTyxFQUFBLFFBQVEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxFQUVHO0FBRWpCLFFBQUksT0FBTyxHQUFHLHNCQUFBLENBQUEsSUFBQSxFQUFBLFFBQUEsQ0FBQSxDQUFBLEtBQUEsQ0FBZCxJQUFjLENBQWQ7O0FBRmlCLGFBSWpCLGtCQUNFLHFCQURJLE9BQ0osQ0FERixFQUVFLHlCQUF5QixJQUFJLEtBQUssS0FObkIsa0NBSWpCLENBSmlCO0FBU2pCLFFBQUksUUFBUSxHQUFHLElBQUEsUUFBQSxDQUFBLE9BQUEsRUFBQSxLQUFBLENBQWYsS0FBZSxDQUFmO0FBVGlCLGFBV2pCLGtCQUNFLFFBQVEsS0FESixJQUFOLEVBRUUseUJBQXlCLElBQUksS0FBSyxLQWJuQixrQ0FXakIsQ0FYaUI7QUFnQmpCLFdBQUEsUUFBQTtBQUNEOztBQXdDRCxFQUFBLElBQUksQ0FBQSxJQUFBLEVBQUEsS0FBQSxFQUdGO0FBSEUsRUFBQSxRQUFBLEVBSXNDO0FBRXhDLElBQUEsc0JBQUEsQ0FBQSxJQUFBLEVBQUEsUUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsRUFBc0IsTUFBTSxJQUE1QixJQUE0QixFQUE1QixFQUFBLEdBQUEsQ0FBQSxLQUFBLEVBQUEsUUFBQTs7QUFFQSxXQUFBLElBQUE7QUFDRDs7QUE5RVU7Ozs7QUFpRmIsU0FBQSxVQUFBLENBQUEsSUFBQSxFQUFvQztBQUNsQyxVQUFBLElBQUE7QUFDRSxTQUFBO0FBQUE7QUFBQTtBQUNBLFNBQUE7QUFBQTtBQUFBO0FBQ0EsU0FBQTtBQUFBO0FBQUE7QUFDRSxhQUFBLFdBQUE7O0FBQ0Y7QUFDRSxhQUFBLElBQUE7QUFOSjtBQVFEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXNzZXJ0LCBpc1ByZXNlbnQgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcblxuaW1wb3J0IHsgQ2hhclBvc2l0aW9uLCBIYnNQb3NpdGlvbiwgSW52aXNpYmxlUG9zaXRpb24sIE9mZnNldEtpbmQsIFBvc2l0aW9uRGF0YSB9IGZyb20gJy4vb2Zmc2V0JztcblxuLyoqXG4gKiBUaGlzIGZpbGUgaW1wbGVtZW50cyB0aGUgRFNMIHVzZWQgYnkgc3BhbiBhbmQgb2Zmc2V0IGluIHBsYWNlcyB3aGVyZSB0aGV5IG5lZWQgdG8gZXhoYXVzdGl2ZWx5XG4gKiBjb25zaWRlciBhbGwgY29tYmluYXRpb25zIG9mIHN0YXRlcyAoSGFuZGxlYmFycyBvZmZzZXRzLCBjaGFyYWN0ZXIgb2Zmc2V0cyBhbmQgaW52aXNpYmxlL2Jyb2tlblxuICogb2Zmc2V0cykuXG4gKlxuICogSXQncyBwcm9iYWJseSBvdmVya2lsbCwgYnV0IGl0IG1ha2VzIHRoZSBjb2RlIHRoYXQgdXNlcyBpdCBjbGVhci4gSXQgY291bGQgYmUgcmVmYWN0b3JlZCBvclxuICogcmVtb3ZlZC5cbiAqL1xuXG5leHBvcnQgY29uc3QgTWF0Y2hBbnkgPSAnTUFUQ0hfQU5ZJztcbmV4cG9ydCB0eXBlIE1hdGNoQW55ID0gJ01BVENIX0FOWSc7XG5cbnR5cGUgTWF0Y2hlcyA9XG4gIHwgJ0NoYXIsSGJzJ1xuICB8ICdIYnMsQ2hhcidcbiAgfCAnSGJzLEhicydcbiAgfCAnQ2hhcixDaGFyJ1xuICB8ICdJbnZpc2libGUsQW55J1xuICB8ICdBbnksSW52aXNpYmxlJztcblxuZXhwb3J0IGNvbnN0IElzSW52aXNpYmxlID0gJ0lTX0lOVklTSUJMRSc7XG5leHBvcnQgdHlwZSBJc0ludmlzaWJsZSA9ICdJU19JTlZJU0lCTEUnO1xuXG50eXBlIFBhdHRlcm4gPSBPZmZzZXRLaW5kIHwgSXNJbnZpc2libGUgfCBNYXRjaEFueTtcblxuY2xhc3MgV2hlbkxpc3Q8T3V0PiB7XG4gICN3aGVuczogV2hlbjxPdXQ+W107XG5cbiAgY29uc3RydWN0b3Iod2hlbnM6IFdoZW48T3V0PltdKSB7XG4gICAgdGhpcy4jd2hlbnMgPSB3aGVucztcbiAgfVxuXG4gIGZpcnN0KGtpbmQ6IE9mZnNldEtpbmQpOiBPdXQgfCBudWxsIHtcbiAgICBmb3IgKGxldCB3aGVuIG9mIHRoaXMuI3doZW5zKSB7XG4gICAgICBsZXQgdmFsdWUgPSB3aGVuLm1hdGNoKGtpbmQpO1xuICAgICAgaWYgKGlzUHJlc2VudCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlWzBdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmNsYXNzIFdoZW48T3V0PiB7XG4gICNtYXA6IE1hcDxQYXR0ZXJuLCBPdXQ+ID0gbmV3IE1hcCgpO1xuXG4gIGdldChwYXR0ZXJuOiBQYXR0ZXJuLCBvcjogKCkgPT4gT3V0KTogT3V0IHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLiNtYXAuZ2V0KHBhdHRlcm4pO1xuXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgdmFsdWUgPSBvcigpO1xuXG4gICAgdGhpcy4jbWFwLnNldChwYXR0ZXJuLCB2YWx1ZSk7XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBhZGQocGF0dGVybjogUGF0dGVybiwgb3V0OiBPdXQpOiB2b2lkIHtcbiAgICB0aGlzLiNtYXAuc2V0KHBhdHRlcm4sIG91dCk7XG4gIH1cblxuICBtYXRjaChraW5kOiBPZmZzZXRLaW5kKTogT3V0W10ge1xuICAgIGxldCBwYXR0ZXJuID0gcGF0dGVybkZvcihraW5kKTtcblxuICAgIGxldCBvdXQ6IE91dFtdID0gW107XG5cbiAgICBsZXQgZXhhY3QgPSB0aGlzLiNtYXAuZ2V0KHBhdHRlcm4pO1xuICAgIGxldCBmYWxsYmFjayA9IHRoaXMuI21hcC5nZXQoTWF0Y2hBbnkpO1xuXG4gICAgaWYgKGV4YWN0KSB7XG4gICAgICBvdXQucHVzaChleGFjdCk7XG4gICAgfVxuXG4gICAgaWYgKGZhbGxiYWNrKSB7XG4gICAgICBvdXQucHVzaChmYWxsYmFjayk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dDtcbiAgfVxufVxuXG50eXBlIEV4aGF1c3RpdmVDaGVjazxPdXQsIEluIGV4dGVuZHMgTWF0Y2hlcywgUmVtb3ZlZCBleHRlbmRzIE1hdGNoZXM+ID0gRXhjbHVkZTxcbiAgSW4sXG4gIFJlbW92ZWRcbj4gZXh0ZW5kcyBuZXZlclxuICA/IEV4aGF1c3RpdmVNYXRjaGVyPE91dD5cbiAgOiBNYXRjaGVyPE91dCwgRXhjbHVkZTxJbiwgUmVtb3ZlZD4+O1xuXG5leHBvcnQgdHlwZSBNYXRjaEZuPE91dD4gPSAobGVmdDogUG9zaXRpb25EYXRhLCByaWdodDogUG9zaXRpb25EYXRhKSA9PiBPdXQ7XG5cbmludGVyZmFjZSBFeGhhdXN0aXZlTWF0Y2hlcjxPdXQ+IHtcbiAgY2hlY2soKTogTWF0Y2hGbjxPdXQ+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2g8T3V0PihjYWxsYmFjazogKG06IE1hdGNoZXI8T3V0PikgPT4gRXhoYXVzdGl2ZU1hdGNoZXI8T3V0Pik6IE1hdGNoRm48T3V0PiB7XG4gIHJldHVybiBjYWxsYmFjayhuZXcgTWF0Y2hlcigpKS5jaGVjaygpO1xufVxuXG5jbGFzcyBNYXRjaGVyPE91dCwgTSBleHRlbmRzIE1hdGNoZXMgPSBNYXRjaGVzPiB7XG4gICN3aGVuczogV2hlbjxXaGVuPChsZWZ0OiBQb3NpdGlvbkRhdGEsIHJpZ2h0OiBQb3NpdGlvbkRhdGEpID0+IE91dD4+ID0gbmV3IFdoZW4oKTtcblxuICAvKipcbiAgICogWW91IGRpZG4ndCBleGhhdXN0aXZlbHkgbWF0Y2ggYWxsIHBvc3NpYmlsaXRpZXMuXG4gICAqL1xuICBwcm90ZWN0ZWQgY2hlY2soKTogTWF0Y2hGbjxPdXQ+IHtcbiAgICByZXR1cm4gKGxlZnQsIHJpZ2h0KSA9PiB0aGlzLm1hdGNoRm9yKGxlZnQua2luZCwgcmlnaHQua2luZCkobGVmdCwgcmlnaHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBtYXRjaEZvcihcbiAgICBsZWZ0OiBPZmZzZXRLaW5kLFxuICAgIHJpZ2h0OiBPZmZzZXRLaW5kXG4gICk6IChsZWZ0OiBQb3NpdGlvbkRhdGEsIHJpZ2h0OiBQb3NpdGlvbkRhdGEpID0+IE91dCB7XG4gICAgbGV0IG5lc3RlZHMgPSB0aGlzLiN3aGVucy5tYXRjaChsZWZ0KTtcblxuICAgIGFzc2VydChcbiAgICAgIGlzUHJlc2VudChuZXN0ZWRzKSxcbiAgICAgIGBubyBtYXRjaCBkZWZpbmVkIGZvciAoJHtsZWZ0fSwgJHtyaWdodH0pIGFuZCBubyBBbnlNYXRjaCBkZWZpbmVkIGVpdGhlcmBcbiAgICApO1xuXG4gICAgbGV0IGNhbGxiYWNrID0gbmV3IFdoZW5MaXN0KG5lc3RlZHMpLmZpcnN0KHJpZ2h0KTtcblxuICAgIGFzc2VydChcbiAgICAgIGNhbGxiYWNrICE9PSBudWxsLFxuICAgICAgYG5vIG1hdGNoIGRlZmluZWQgZm9yICgke2xlZnR9LCAke3JpZ2h0fSkgYW5kIG5vIEFueU1hdGNoIGRlZmluZWQgZWl0aGVyYFxuICAgICk7XG5cbiAgICByZXR1cm4gY2FsbGJhY2s7XG4gIH1cblxuICAvLyBUaGlzIGJpZyBibG9jayBpcyB0aGUgYnVsayBvZiB0aGUgaGVhdnkgbGlmdGluZyBpbiB0aGlzIGZpbGUuIEl0IGZhY2lsaXRhdGVzIGV4aGF1c3RpdmVuZXNzXG4gIC8vIGNoZWNraW5nIHNvIHRoYXQgbWF0Y2hlcnMgY2FuIGVuc3VyZSB0aGV5J3ZlIGFjdHVhbGx5IGNvdmVyZWQgYWxsIHRoZSBjYXNlcyAoYW5kIFR5cGVTY3JpcHRcbiAgLy8gd2lsbCB0cmVhdCBpdCBhcyBhbiBleGhhdXN0aXZlIG1hdGNoKS5cbiAgd2hlbihcbiAgICBsZWZ0OiBPZmZzZXRLaW5kLkNoYXJQb3NpdGlvbixcbiAgICByaWdodDogT2Zmc2V0S2luZC5IYnNQb3NpdGlvbixcbiAgICBjYWxsYmFjazogKGxlZnQ6IENoYXJQb3NpdGlvbiwgcmlnaHQ6IEhic1Bvc2l0aW9uKSA9PiBPdXRcbiAgKTogRXhoYXVzdGl2ZUNoZWNrPE91dCwgTSwgJ0NoYXIsSGJzJz47XG4gIHdoZW4oXG4gICAgbGVmdDogT2Zmc2V0S2luZC5IYnNQb3NpdGlvbixcbiAgICByaWdodDogT2Zmc2V0S2luZC5DaGFyUG9zaXRpb24sXG4gICAgY2FsbGJhY2s6IChsZWZ0OiBIYnNQb3NpdGlvbiwgcmlnaHQ6IENoYXJQb3NpdGlvbikgPT4gT3V0XG4gICk6IEV4aGF1c3RpdmVDaGVjazxPdXQsIE0sICdIYnMsQ2hhcic+O1xuICB3aGVuKFxuICAgIGxlZnQ6IE9mZnNldEtpbmQuSGJzUG9zaXRpb24sXG4gICAgcmlnaHQ6IE9mZnNldEtpbmQuSGJzUG9zaXRpb24sXG4gICAgY2FsbGJhY2s6IChsZWZ0OiBIYnNQb3NpdGlvbiwgcmlnaHQ6IEhic1Bvc2l0aW9uKSA9PiBPdXRcbiAgKTogRXhoYXVzdGl2ZUNoZWNrPE91dCwgTSwgJ0hicyxIYnMnPjtcbiAgd2hlbihcbiAgICBsZWZ0OiBPZmZzZXRLaW5kLkNoYXJQb3NpdGlvbixcbiAgICByaWdodDogT2Zmc2V0S2luZC5DaGFyUG9zaXRpb24sXG4gICAgY2FsbGJhY2s6IChsZWZ0OiBDaGFyUG9zaXRpb24sIHJpZ2h0OiBDaGFyUG9zaXRpb24pID0+IE91dFxuICApOiBFeGhhdXN0aXZlQ2hlY2s8T3V0LCBNLCAnQ2hhcixDaGFyJz47XG4gIHdoZW4oXG4gICAgbGVmdDogSXNJbnZpc2libGUsXG4gICAgcmlnaHQ6IE1hdGNoQW55LFxuICAgIGNhbGxiYWNrOiAobGVmdDogSW52aXNpYmxlUG9zaXRpb24sIHJpZ2h0OiBQb3NpdGlvbkRhdGEpID0+IE91dFxuICApOiBNYXRjaGVyPE91dCwgRXhjbHVkZTxNLCAnSW52aXNpYmxlLEFueSc+PjtcbiAgd2hlbihcbiAgICBsZWZ0OiBNYXRjaEFueSxcbiAgICByaWdodDogSXNJbnZpc2libGUsXG4gICAgY2FsbGJhY2s6IChsZWZ0OiBQb3NpdGlvbkRhdGEsIHJpZ2h0OiBJbnZpc2libGVQb3NpdGlvbikgPT4gT3V0XG4gICk6IEV4aGF1c3RpdmVDaGVjazxPdXQsIE0sICdBbnksSW52aXNpYmxlJz47XG4gIHdoZW4oXG4gICAgbGVmdDogTWF0Y2hBbnksXG4gICAgcmlnaHQ6IE1hdGNoQW55LFxuICAgIGNhbGxiYWNrOiAobGVmdDogUG9zaXRpb25EYXRhLCByaWdodDogUG9zaXRpb25EYXRhKSA9PiBPdXRcbiAgKTogRXhoYXVzdGl2ZU1hdGNoZXI8T3V0PjtcbiAgd2hlbihcbiAgICBsZWZ0OiBQYXR0ZXJuLFxuICAgIHJpZ2h0OiBQYXR0ZXJuLFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgY2FsbGJhY2s6IChsZWZ0OiBhbnksIHJpZ2h0OiBhbnkpID0+IE91dFxuICApOiBNYXRjaGVyPE91dCwgTWF0Y2hlcz4gfCBFeGhhdXN0aXZlTWF0Y2hlcjxPdXQ+IHtcbiAgICB0aGlzLiN3aGVucy5nZXQobGVmdCwgKCkgPT4gbmV3IFdoZW4oKSkuYWRkKHJpZ2h0LCBjYWxsYmFjayk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuXG5mdW5jdGlvbiBwYXR0ZXJuRm9yKGtpbmQ6IE9mZnNldEtpbmQpOiBQYXR0ZXJuIHtcbiAgc3dpdGNoIChraW5kKSB7XG4gICAgY2FzZSBPZmZzZXRLaW5kLkJyb2tlbjpcbiAgICBjYXNlIE9mZnNldEtpbmQuSW50ZXJuYWxzU3ludGhldGljOlxuICAgIGNhc2UgT2Zmc2V0S2luZC5Ob25FeGlzdGVudDpcbiAgICAgIHJldHVybiBJc0ludmlzaWJsZTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGtpbmQ7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=