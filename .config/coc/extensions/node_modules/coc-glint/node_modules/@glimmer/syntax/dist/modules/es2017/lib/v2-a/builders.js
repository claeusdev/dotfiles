var __rest = this && this.__rest || function (s, e) {
  var t = {};

  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];

  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
};

import { assert, assertPresent, assign } from '@glimmer/util';
import { SourceSlice } from '../source/slice';
import { SpanList } from '../source/span-list';
import * as ASTv2 from './api';
export class Builder {
  // TEMPLATE //
  template(symbols, body, loc) {
    return new ASTv2.Template({
      table: symbols,
      body,
      loc
    });
  } // INTERNAL (these nodes cannot be reached when doing general-purpose visiting) //


  block(symbols, body, loc) {
    return new ASTv2.Block({
      scope: symbols,
      body,
      loc
    });
  }

  namedBlock(name, block, loc) {
    return new ASTv2.NamedBlock({
      name,
      block,
      attrs: [],
      componentArgs: [],
      modifiers: [],
      loc
    });
  }

  simpleNamedBlock(name, block, loc) {
    return new BuildElement({
      selfClosing: false,
      attrs: [],
      componentArgs: [],
      modifiers: [],
      comments: []
    }).named(name, block, loc);
  }

  slice(chars, loc) {
    return new SourceSlice({
      loc,
      chars
    });
  }

  args(positional, named, loc) {
    return new ASTv2.Args({
      loc,
      positional,
      named
    });
  }

  positional(exprs, loc) {
    return new ASTv2.PositionalArguments({
      loc,
      exprs
    });
  }

  namedArgument(key, value) {
    return new ASTv2.NamedArgument({
      name: key,
      value
    });
  }

  named(entries, loc) {
    return new ASTv2.NamedArguments({
      loc,
      entries
    });
  }

  attr({
    name,
    value,
    trusting
  }, loc) {
    return new ASTv2.HtmlAttr({
      loc,
      name,
      value,
      trusting
    });
  }

  splatAttr(symbol, loc) {
    return new ASTv2.SplatAttr({
      symbol,
      loc
    });
  }

  arg({
    name,
    value,
    trusting
  }, loc) {
    return new ASTv2.ComponentArg({
      name,
      value,
      trusting,
      loc
    });
  } // EXPRESSIONS //


  path(head, tail, loc) {
    return new ASTv2.PathExpression({
      loc,
      ref: head,
      tail
    });
  }

  self(loc) {
    return new ASTv2.ThisReference({
      loc
    });
  }

  at(name, symbol, loc) {
    // the `@` should be included so we have a complete source range
    (false && assert(name[0] === '@', `call builders.at() with a string that starts with '@'`));
    return new ASTv2.ArgReference({
      loc,
      name: new SourceSlice({
        loc,
        chars: name
      }),
      symbol
    });
  }

  freeVar({
    name,
    context,
    symbol,
    loc
  }) {
    (false && assert(name !== 'this', `You called builders.freeVar() with 'this'. Call builders.this instead`));
    (false && assert(name[0] !== '@', `You called builders.freeVar() with '${name}'. Call builders.at('${name}') instead`));
    return new ASTv2.FreeVarReference({
      name,
      resolution: context,
      symbol,
      loc
    });
  }

  localVar(name, symbol, isTemplateLocal, loc) {
    (false && assert(name !== 'this', `You called builders.var() with 'this'. Call builders.this instead`));
    (false && assert(name[0] !== '@', `You called builders.var() with '${name}'. Call builders.at('${name}') instead`));
    return new ASTv2.LocalVarReference({
      loc,
      name,
      isTemplateLocal,
      symbol
    });
  }

  sexp(parts, loc) {
    return new ASTv2.CallExpression({
      loc,
      callee: parts.callee,
      args: parts.args
    });
  }

  interpolate(parts, loc) {
    assertPresent(parts);
    return new ASTv2.InterpolateExpression({
      loc,
      parts
    });
  }

  literal(value, loc) {
    return new ASTv2.LiteralExpression({
      loc,
      value
    });
  } // STATEMENTS //


  append({
    table,
    trusting,
    value
  }, loc) {
    return new ASTv2.AppendContent({
      table,
      trusting,
      value,
      loc
    });
  }

  modifier({
    callee,
    args
  }, loc) {
    return new ASTv2.ElementModifier({
      loc,
      callee,
      args
    });
  }

  namedBlocks(blocks, loc) {
    return new ASTv2.NamedBlocks({
      loc,
      blocks
    });
  }

  blockStatement(_a, loc) {
    var {
      symbols,
      program,
      inverse = null
    } = _a,
        call = __rest(_a, ["symbols", "program", "inverse"]);

    let blocksLoc = program.loc;
    let blocks = [this.namedBlock(SourceSlice.synthetic('default'), program, program.loc)];

    if (inverse) {
      blocksLoc = blocksLoc.extend(inverse.loc);
      blocks.push(this.namedBlock(SourceSlice.synthetic('else'), inverse, inverse.loc));
    }

    return new ASTv2.InvokeBlock({
      loc,
      blocks: this.namedBlocks(blocks, blocksLoc),
      callee: call.callee,
      args: call.args
    });
  }

  element(options) {
    return new BuildElement(options);
  }

}
export class BuildElement {
  constructor(base) {
    this.base = base;
    this.builder = new Builder();
  }

  simple(tag, body, loc) {
    return new ASTv2.SimpleElement(assign({
      tag,
      body,
      componentArgs: [],
      loc
    }, this.base));
  }

  named(name, block, loc) {
    return new ASTv2.NamedBlock(assign({
      name,
      block,
      componentArgs: [],
      loc
    }, this.base));
  }

  selfClosingComponent(callee, loc) {
    return new ASTv2.InvokeComponent(assign({
      loc,
      callee,
      // point the empty named blocks at the `/` self-closing tag
      blocks: new ASTv2.NamedBlocks({
        blocks: [],
        loc: loc.sliceEndChars({
          skipEnd: 1,
          chars: 1
        })
      })
    }, this.base));
  }

  componentWithDefaultBlock(callee, children, symbols, loc) {
    let block = this.builder.block(symbols, children, loc);
    let namedBlock = this.builder.namedBlock(SourceSlice.synthetic('default'), block, loc); // BUILDER.simpleNamedBlock('default', children, symbols, loc);

    return new ASTv2.InvokeComponent(assign({
      loc,
      callee,
      blocks: this.builder.namedBlocks([namedBlock], namedBlock.loc)
    }, this.base));
  }

  componentWithNamedBlocks(callee, blocks, loc) {
    return new ASTv2.InvokeComponent(assign({
      loc,
      callee,
      blocks: this.builder.namedBlocks(blocks, SpanList.range(blocks))
    }, this.base));
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvdjItYS9idWlsZGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUNBLFNBQVMsTUFBVCxFQUFpQixhQUFqQixFQUFnQyxNQUFoQyxRQUE4QyxlQUE5QztBQUVBLFNBQVMsV0FBVCxRQUE0QixpQkFBNUI7QUFFQSxTQUFTLFFBQVQsUUFBeUIscUJBQXpCO0FBRUEsT0FBTyxLQUFLLEtBQVosTUFBdUIsT0FBdkI7QUFPQSxPQUFNLE1BQU8sT0FBUCxDQUFjO0FBQ2xCO0FBRUEsRUFBQSxRQUFRLENBQ04sT0FETSxFQUVOLElBRk0sRUFHTixHQUhNLEVBR1M7QUFFZixXQUFPLElBQUksS0FBSyxDQUFDLFFBQVYsQ0FBbUI7QUFDeEIsTUFBQSxLQUFLLEVBQUUsT0FEaUI7QUFFeEIsTUFBQSxJQUZ3QjtBQUd4QixNQUFBO0FBSHdCLEtBQW5CLENBQVA7QUFLRCxHQWJpQixDQWVsQjs7O0FBRUEsRUFBQSxLQUFLLENBQUMsT0FBRCxFQUE0QixJQUE1QixFQUF1RCxHQUF2RCxFQUFzRTtBQUN6RSxXQUFPLElBQUksS0FBSyxDQUFDLEtBQVYsQ0FBZ0I7QUFDckIsTUFBQSxLQUFLLEVBQUUsT0FEYztBQUVyQixNQUFBLElBRnFCO0FBR3JCLE1BQUE7QUFIcUIsS0FBaEIsQ0FBUDtBQUtEOztBQUVELEVBQUEsVUFBVSxDQUFDLElBQUQsRUFBb0IsS0FBcEIsRUFBd0MsR0FBeEMsRUFBdUQ7QUFDL0QsV0FBTyxJQUFJLEtBQUssQ0FBQyxVQUFWLENBQXFCO0FBQzFCLE1BQUEsSUFEMEI7QUFFMUIsTUFBQSxLQUYwQjtBQUcxQixNQUFBLEtBQUssRUFBRSxFQUhtQjtBQUkxQixNQUFBLGFBQWEsRUFBRSxFQUpXO0FBSzFCLE1BQUEsU0FBUyxFQUFFLEVBTGU7QUFNMUIsTUFBQTtBQU4wQixLQUFyQixDQUFQO0FBUUQ7O0FBRUQsRUFBQSxnQkFBZ0IsQ0FBQyxJ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WDtBQUFjLFVBQUEsS0FBSyxFQUFFO0FBQXJCLFNBQWxCO0FBRnVCLE9BQXRCO0FBSlYsS0FESSxFQVVKLEtBQUssSUFWRCxDQURELENBQVA7QUFjRDs7QUFFRCxFQUFBLHlCQUF5QixDQUN2QixNQUR1QixFQUV2QixRQUZ1QixFQUd2QixPQUh1QixFQUl2QixHQUp1QixFQUlSO0FBRWYsUUFBSSxLQUFLLEdBQUcsS0FBSyxPQUFMLENBQWEsS0FBYixDQUFtQixPQUFuQixFQUE0QixRQUE1QixFQUFzQyxHQUF0QyxDQUFaO0FBQ0EsUUFBSSxVQUFVLEdBQUcsS0FBSyxPQUFMLENBQWEsVUFBYixDQUF3QixXQUFXLENBQUMsU0FBWixDQUFzQixTQUF0QixDQUF4QixFQUEwRCxLQUExRCxFQUFpRSxHQUFqRSxDQUFqQixDQUhlLENBR3lFOztBQUV4RixXQUFPLElBQUksS0FBSyxDQUFDLGVBQVYsQ0FDTCxNQUFNLENBQ0o7QUFDRSxNQUFBLEdBREY7QUFFRSxNQUFBLE1BRkY7QUFHRSxNQUFBLE1BQU0sRUFBRSxLQUFLLE9BQUwsQ0FBYSxXQUFiLENBQXlCLENBQUMsVUFBRCxDQUF6QixFQUF1QyxVQUFVLENBQUMsR0FBbEQ7QUFIVixLQURJLEVBTUosS0FBSyxJQU5ELENBREQsQ0FBUDtBQVVEOztBQUVELEVBQUEsd0JBQXdCLENBQ3RCLE1BRHNCLEVBRXRCLE1BRnNCLEVBR3RCLEdBSHNCLEVBR1A7QUFFZixXQUFPLElBQUksS0FBSyxDQUFDLGVBQVYsQ0FDTCxNQUFNLENBQ0o7QUFDRSxNQUFBLEdBREY7QUFFRSxNQUFBLE1BRkY7QUFHRSxNQUFBLE1BQU0sRUFBRSxLQUFLLE9BQUwsQ0FBYSxXQUFiLENBQXlCLE1BQXpCLEVBQWlDLFFBQVEsQ0FBQyxLQUFULENBQWUsTUFBZixDQUFqQztBQUhWLEtBREksRUFNSixLQUFLLElBTkQsQ0FERCxDQUFQO0FBVUQ7O0FBdkZzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUHJlc2VudEFycmF5IH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBhc3NlcnQsIGFzc2VydFByZXNlbnQsIGFzc2lnbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuXG5pbXBvcnQgeyBTb3VyY2VTbGljZSB9IGZyb20gJy4uL3NvdXJjZS9zbGljZSc7XG5pbXBvcnQgeyBTb3VyY2VTcGFuIH0gZnJvbSAnLi4vc291cmNlL3NwYW4nO1xuaW1wb3J0IHsgU3Bhbkxpc3QgfSBmcm9tICcuLi9zb3VyY2Uvc3Bhbi1saXN0JztcbmltcG9ydCB7IEJsb2NrU3ltYm9sVGFibGUsIFByb2dyYW1TeW1ib2xUYWJsZSwgU3ltYm9sVGFibGUgfSBmcm9tICcuLi9zeW1ib2wtdGFibGUnO1xuaW1wb3J0ICogYXMgQVNUdjIgZnJvbSAnLi9hcGknO1xuXG5leHBvcnQgaW50ZXJmYWNlIENhbGxQYXJ0cyB7XG4gIGNhbGxlZTogQVNUdjIuRXhwcmVzc2lvbk5vZGU7XG4gIGFyZ3M6IEFTVHYyLkFyZ3M7XG59XG5cbmV4cG9ydCBjbGFzcyBCdWlsZGVyIHtcbiAgLy8gVEVNUExBVEUgLy9cblxuICB0ZW1wbGF0ZShcbiAgICBzeW1ib2xzOiBQcm9ncmFtU3ltYm9sVGFibGUsXG4gICAgYm9keTogQVNUdjIuQ29udGVudE5vZGVbXSxcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuVGVtcGxhdGUge1xuICAgIHJldHVybiBuZXcgQVNUdjIuVGVtcGxhdGUoe1xuICAgICAgdGFibGU6IHN5bWJvbHMsXG4gICAgICBib2R5LFxuICAgICAgbG9jLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gSU5URVJOQUwgKHRoZXNlIG5vZGVzIGNhbm5vdCBiZSByZWFjaGVkIHdoZW4gZG9pbmcgZ2VuZXJhbC1wdXJwb3NlIHZpc2l0aW5nKSAvL1xuXG4gIGJsb2NrKHN5bWJvbHM6IEJsb2NrU3ltYm9sVGFibGUsIGJvZHk6IEFTVHYyLkNvbnRlbnROb2RlW10sIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLkJsb2NrIHtcbiAgICByZXR1cm4gbmV3IEFTVHYyLkJsb2NrKHtcbiAgICAgIHNjb3BlOiBzeW1ib2xzLFxuICAgICAgYm9keSxcbiAgICAgIGxvYyxcbiAgICB9KTtcbiAgfVxuXG4gIG5hbWVkQmxvY2sobmFtZTogU291cmNlU2xpY2UsIGJsb2NrOiBBU1R2Mi5CbG9jaywgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuTmFtZWRCbG9jayB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5OYW1lZEJsb2NrKHtcbiAgICAgIG5hbWUsXG4gICAgICBibG9jayxcbiAgICAgIGF0dHJzOiBbXSxcbiAgICAgIGNvbXBvbmVudEFyZ3M6IFtdLFxuICAgICAgbW9kaWZpZXJzOiBbXSxcbiAgICAgIGxvYyxcbiAgICB9KTtcbiAgfVxuXG4gIHNpbXBsZU5hbWVkQmxvY2sobmFtZTogU291cmNlU2xpY2UsIGJsb2NrOiBBU1R2Mi5CbG9jaywgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuTmFtZWRCbG9jayB7XG4gICAgcmV0dXJuIG5ldyBCdWlsZEVsZW1lbnQoe1xuICAgICAgc2VsZkNsb3Npbmc6IGZhbHNlLFxuICAgICAgYXR0cnM6IFtdLFxuICAgICAgY29tcG9uZW50QXJnczogW10sXG4gICAgICBtb2RpZmllcnM6IFtdLFxuICAgICAgY29tbWVudHM6IFtdLFxuICAgIH0pLm5hbWVkKG5hbWUsIGJsb2NrLCBsb2MpO1xuICB9XG5cbiAgc2xpY2UoY2hhcnM6IHN0cmluZywgbG9jOiBTb3VyY2VTcGFuKTogU291cmNlU2xpY2Uge1xuICAgIHJldHVybiBuZXcgU291cmNlU2xpY2Uoe1xuICAgICAgbG9jLFxuICAgICAgY2hhcnMsXG4gICAgfSk7XG4gIH1cblxuICBhcmdzKFxuICAgIHBvc2l0aW9uYWw6IEFTVHYyLlBvc2l0aW9uYWxBcmd1bWVudHMsXG4gICAgbmFtZWQ6IEFTVHYyLk5hbWVkQXJndW1lbnRzLFxuICAgIGxvYzogU291cmNlU3BhblxuICApOiBBU1R2Mi5BcmdzIHtcbiAgICByZXR1cm4gbmV3IEFTVHYyLkFyZ3Moe1xuICAgICAgbG9jLFxuICAgICAgcG9zaXRpb25hbCxcbiAgICAgIG5hbWVkLFxuICAgIH0pO1xuICB9XG5cbiAgcG9zaXRpb25hbChleHByczogQVNUdjIuRXhwcmVzc2lvbk5vZGVbXSwgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuUG9zaXRpb25hbEFyZ3VtZW50cyB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5Qb3NpdGlvbmFsQXJndW1lbnRzKHtcbiAgICAgIGxvYyxcbiAgICAgIGV4cHJzLFxuICAgIH0pO1xuICB9XG5cbiAgbmFtZWRBcmd1bWVudChrZXk6IFNvdXJjZVNsaWNlLCB2YWx1ZTogQVNUdjIuRXhwcmVzc2lvbk5vZGUpOiBBU1R2Mi5OYW1lZEFyZ3VtZW50IHtcbiAgICByZXR1cm4gbmV3IEFTVHYyLk5hbWVkQXJndW1lbnQoe1xuICAgICAgbmFtZToga2V5LFxuICAgICAgdmFsdWUsXG4gICAgfSk7XG4gIH1cblxuICBuYW1lZChlbnRyaWVzOiBBU1R2Mi5OYW1lZEFyZ3VtZW50W10sIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLk5hbWVkQXJndW1lbnRzIHtcbiAgICByZXR1cm4gbmV3IEFTVHYyLk5hbWVkQXJndW1lbnRzKHtcbiAgICAgIGxvYyxcbiAgICAgIGVudHJpZXMsXG4gICAgfSk7XG4gIH1cblxuICBhdHRyKFxuICAgIHtcbiAgICAgIG5hbWUsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydXN0aW5nLFxuICAgIH06IHsgbmFtZTogU291cmNlU2xpY2U7IHZhbHVlOiBBU1R2Mi5FeHByZXNzaW9uTm9kZTsgdHJ1c3Rpbmc6IGJvb2xlYW4gfSxcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuSHRtbEF0dHIge1xuICAgIHJldHVybiBuZXcgQVNUdjIuSHRtbEF0dHIoe1xuICAgICAgbG9jLFxuICAgICAgbmFtZSxcbiAgICAgIHZhbHVlLFxuICAgICAgdHJ1c3RpbmcsXG4gICAgfSk7XG4gIH1cblxuICBzcGxhdEF0dHIoc3ltYm9sOiBudW1iZXIsIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLlNwbGF0QXR0ciB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5TcGxhdEF0dHIoe1xuICAgICAgc3ltYm9sLFxuICAgICAgbG9jLFxuICAgIH0pO1xuICB9XG5cbiAgYXJnKFxuICAgIHtcbiAgICAgIG5hbWUsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydXN0aW5nLFxuICAgIH06IHsgbmFtZTogU291cmNlU2xpY2U7IHZhbHVlOiBBU1R2Mi5FeHByZXNzaW9uTm9kZTsgdHJ1c3Rpbmc6IGJvb2xlYW4gfSxcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuQ29tcG9uZW50QXJnIHtcbiAgICByZXR1cm4gbmV3IEFTVHYyLkNvbXBvbmVudEFyZyh7XG4gICAgICBuYW1lLFxuICAgICAgdmFsdWUsXG4gICAgICB0cnVzdGluZyxcbiAgICAgIGxvYyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEVYUFJFU1NJT05TIC8vXG5cbiAgcGF0aChoZWFkOiBBU1R2Mi5WYXJpYWJsZVJlZmVyZW5jZSwgdGFpbDogU291cmNlU2xpY2VbXSwgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuUGF0aEV4cHJlc3Npb24ge1xuICAgIHJldHVybiBuZXcgQVNUdjIuUGF0aEV4cHJlc3Npb24oe1xuICAgICAgbG9jLFxuICAgICAgcmVmOiBoZWFkLFxuICAgICAgdGFpbCxcbiAgICB9KTtcbiAgfVxuXG4gIHNlbGYobG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuVmFyaWFibGVSZWZlcmVuY2Uge1xuICAgIHJldHVybiBuZXcgQVNUdjIuVGhpc1JlZmVyZW5jZSh7XG4gICAgICBsb2MsXG4gICAgfSk7XG4gIH1cblxuICBhdChuYW1lOiBzdHJpbmcsIHN5bWJvbDogbnVtYmVyLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5WYXJpYWJsZVJlZmVyZW5jZSB7XG4gICAgLy8gdGhlIGBAYCBzaG91bGQgYmUgaW5jbHVkZWQgc28gd2UgaGF2ZSBhIGNvbXBsZXRlIHNvdXJjZSByYW5nZVxuICAgIGFzc2VydChuYW1lWzBdID09PSAnQCcsIGBjYWxsIGJ1aWxkZXJzLmF0KCkgd2l0aCBhIHN0cmluZyB0aGF0IHN0YXJ0cyB3aXRoICdAJ2ApO1xuXG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5BcmdSZWZlcmVuY2Uoe1xuICAgICAgbG9jLFxuICAgICAgbmFtZTogbmV3IFNvdXJjZVNsaWNlKHsgbG9jLCBjaGFyczogbmFtZSB9KSxcbiAgICAgIHN5bWJvbCxcbiAgICB9KTtcbiAgfVxuXG4gIGZyZWVWYXIoe1xuICAgIG5hbWUsXG4gICAgY29udGV4dCxcbiAgICBzeW1ib2wsXG4gICAgbG9jLFxuICB9OiB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGNvbnRleHQ6IEFTVHYyLkZyZWVWYXJSZXNvbHV0aW9uO1xuICAgIHN5bWJvbDogbnVtYmVyO1xuICAgIGxvYzogU291cmNlU3BhbjtcbiAgfSk6IEFTVHYyLlZhcmlhYmxlUmVmZXJlbmNlIHtcbiAgICBhc3NlcnQoXG4gICAgICBuYW1lICE9PSAndGhpcycsXG4gICAgICBgWW91IGNhbGxlZCBidWlsZGVycy5mcmVlVmFyKCkgd2l0aCAndGhpcycuIENhbGwgYnVpbGRlcnMudGhpcyBpbnN0ZWFkYFxuICAgICk7XG4gICAgYXNzZXJ0KFxuICAgICAgbmFtZVswXSAhPT0gJ0AnLFxuICAgICAgYFlvdSBjYWxsZWQgYnVpbGRlcnMuZnJlZVZhcigpIHdpdGggJyR7bmFtZX0nLiBDYWxsIGJ1aWxkZXJzLmF0KCcke25hbWV9JykgaW5zdGVhZGBcbiAgICApO1xuXG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5GcmVlVmFyUmVmZXJlbmNlKHtcbiAgICAgIG5hbWUsXG4gICAgICByZXNvbHV0aW9uOiBjb250ZXh0LFxuICAgICAgc3ltYm9sLFxuICAgICAgbG9jLFxuICAgIH0pO1xuICB9XG5cbiAgbG9jYWxWYXIoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHN5bWJvbDogbnVtYmVyLFxuICAgIGlzVGVtcGxhdGVMb2NhbDogYm9vbGVhbixcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuVmFyaWFibGVSZWZlcmVuY2Uge1xuICAgIGFzc2VydChuYW1lICE9PSAndGhpcycsIGBZb3UgY2FsbGVkIGJ1aWxkZXJzLnZhcigpIHdpdGggJ3RoaXMnLiBDYWxsIGJ1aWxkZXJzLnRoaXMgaW5zdGVhZGApO1xuICAgIGFzc2VydChcbiAgICAgIG5hbWVbMF0gIT09ICdAJyxcbiAgICAgIGBZb3UgY2FsbGVkIGJ1aWxkZXJzLnZhcigpIHdpdGggJyR7bmFtZX0nLiBDYWxsIGJ1aWxkZXJzLmF0KCcke25hbWV9JykgaW5zdGVhZGBcbiAgICApO1xuXG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5Mb2NhbFZhclJlZmVyZW5jZSh7XG4gICAgICBsb2MsXG4gICAgICBuYW1lLFxuICAgICAgaXNUZW1wbGF0ZUxvY2FsLFxuICAgICAgc3ltYm9sLFxuICAgIH0pO1xuICB9XG5cbiAgc2V4cChwYXJ0czogQ2FsbFBhcnRzLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5DYWxsRXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5DYWxsRXhwcmVzc2lvbih7XG4gICAgICBsb2MsXG4gICAgICBjYWxsZWU6IHBhcnRzLmNhbGxlZSxcbiAgICAgIGFyZ3M6IHBhcnRzLmFyZ3MsXG4gICAgfSk7XG4gIH1cblxuICBpbnRlcnBvbGF0ZShwYXJ0czogQVNUdjIuRXhwcmVzc2lvbk5vZGVbXSwgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuSW50ZXJwb2xhdGVFeHByZXNzaW9uIHtcbiAgICBhc3NlcnRQcmVzZW50KHBhcnRzKTtcblxuICAgIHJldHVybiBuZXcgQVNUdjIuSW50ZXJwb2xhdGVFeHByZXNzaW9uKHtcbiAgICAgIGxvYyxcbiAgICAgIHBhcnRzLFxuICAgIH0pO1xuICB9XG5cbiAgbGl0ZXJhbCh2YWx1ZTogc3RyaW5nLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbiAmIHsgdmFsdWU6IHN0cmluZyB9O1xuICBsaXRlcmFsKHZhbHVlOiBudW1iZXIsIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLkxpdGVyYWxFeHByZXNzaW9uICYgeyB2YWx1ZTogbnVtYmVyIH07XG4gIGxpdGVyYWwodmFsdWU6IGJvb2xlYW4sIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLkxpdGVyYWxFeHByZXNzaW9uICYgeyB2YWx1ZTogYm9vbGVhbiB9O1xuICBsaXRlcmFsKHZhbHVlOiBudWxsLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbiAmIHsgdmFsdWU6IG51bGwgfTtcbiAgbGl0ZXJhbCh2YWx1ZTogdW5kZWZpbmVkLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbiAmIHsgdmFsdWU6IHVuZGVmaW5lZCB9O1xuICBsaXRlcmFsKFxuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZCxcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuTGl0ZXJhbEV4cHJlc3Npb247XG4gIGxpdGVyYWwoXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkLFxuICAgIGxvYzogU291cmNlU3BhblxuICApOiBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5MaXRlcmFsRXhwcmVzc2lvbih7XG4gICAgICBsb2MsXG4gICAgICB2YWx1ZSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFNUQVRFTUVOVFMgLy9cblxuICBhcHBlbmQoXG4gICAge1xuICAgICAgdGFibGUsXG4gICAgICB0cnVzdGluZyxcbiAgICAgIHZhbHVlLFxuICAgIH06IHsgdGFibGU6IFN5bWJvbFRhYmxlOyB0cnVzdGluZzogYm9vbGVhbjsgdmFsdWU6IEFTVHYyLkV4cHJlc3Npb25Ob2RlIH0sXG4gICAgbG9jOiBTb3VyY2VTcGFuXG4gICk6IEFTVHYyLkFwcGVuZENvbnRlbnQge1xuICAgIHJldHVybiBuZXcgQVNUdjIuQXBwZW5kQ29udGVudCh7XG4gICAgICB0YWJsZSxcbiAgICAgIHRydXN0aW5nLFxuICAgICAgdmFsdWUsXG4gICAgICBsb2MsXG4gICAgfSk7XG4gIH1cblxuICBtb2RpZmllcih7IGNhbGxlZSwgYXJncyB9OiBDYWxsUGFydHMsIGxvYzogU291cmNlU3Bhbik6IEFTVHYyLkVsZW1lbnRNb2RpZmllciB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5FbGVtZW50TW9kaWZpZXIoe1xuICAgICAgbG9jLFxuICAgICAgY2FsbGVlLFxuICAgICAgYXJncyxcbiAgICB9KTtcbiAgfVxuXG4gIG5hbWVkQmxvY2tzKGJsb2NrczogQVNUdjIuTmFtZWRCbG9ja1tdLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5OYW1lZEJsb2NrcyB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5OYW1lZEJsb2Nrcyh7XG4gICAgICBsb2MsXG4gICAgICBibG9ja3MsXG4gICAgfSk7XG4gIH1cblxuICBibG9ja1N0YXRlbWVudChcbiAgICB7XG4gICAgICBzeW1ib2xzLFxuICAgICAgcHJvZ3JhbSxcbiAgICAgIGludmVyc2UgPSBudWxsLFxuICAgICAgLi4uY2FsbFxuICAgIH06IHtcbiAgICAgIHN5bWJvbHM6IFN5bWJvbFRhYmxlO1xuICAgICAgcHJvZ3JhbTogQVNUdjIuQmxvY2s7XG4gICAgICBpbnZlcnNlPzogQVNUdjIuQmxvY2sgfCBudWxsO1xuICAgIH0gJiBDYWxsUGFydHMsXG4gICAgbG9jOiBTb3VyY2VTcGFuXG4gICk6IEFTVHYyLkludm9rZUJsb2NrIHtcbiAgICBsZXQgYmxvY2tzTG9jID0gcHJvZ3JhbS5sb2M7XG4gICAgbGV0IGJsb2NrczogUHJlc2VudEFycmF5PEFTVHYyLk5hbWVkQmxvY2s+ID0gW1xuICAgICAgdGhpcy5uYW1lZEJsb2NrKFNvdXJjZVNsaWNlLnN5bnRoZXRpYygnZGVmYXVsdCcpLCBwcm9ncmFtLCBwcm9ncmFtLmxvYyksXG4gICAgXTtcbiAgICBpZiAoaW52ZXJzZSkge1xuICAgICAgYmxvY2tzTG9jID0gYmxvY2tzTG9jLmV4dGVuZChpbnZlcnNlLmxvYyk7XG4gICAgICBibG9ja3MucHVzaCh0aGlzLm5hbWVkQmxvY2soU291cmNlU2xpY2Uuc3ludGhldGljKCdlbHNlJyksIGludmVyc2UsIGludmVyc2UubG9jKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5JbnZva2VCbG9jayh7XG4gICAgICBsb2MsXG4gICAgICBibG9ja3M6IHRoaXMubmFtZWRCbG9ja3MoYmxvY2tzLCBibG9ja3NMb2MpLFxuICAgICAgY2FsbGVlOiBjYWxsLmNhbGxlZSxcbiAgICAgIGFyZ3M6IGNhbGwuYXJncyxcbiAgICB9KTtcbiAgfVxuXG4gIGVsZW1lbnQob3B0aW9uczogQnVpbGRCYXNlRWxlbWVudCk6IEJ1aWxkRWxlbWVudCB7XG4gICAgcmV0dXJuIG5ldyBCdWlsZEVsZW1lbnQob3B0aW9ucyk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZEJhc2VFbGVtZW50IHtcbiAgc2VsZkNsb3Npbmc6IGJvb2xlYW47XG4gIGF0dHJzOiBBU1R2Mi5IdG1sT3JTcGxhdEF0dHJbXTtcbiAgY29tcG9uZW50QXJnczogQVNUdjIuQ29tcG9uZW50QXJnW107XG4gIG1vZGlmaWVyczogQVNUdjIuRWxlbWVudE1vZGlmaWVyW107XG4gIGNvbW1lbnRzOiBBU1R2Mi5HbGltbWVyQ29tbWVudFtdO1xufVxuXG5leHBvcnQgY2xhc3MgQnVpbGRFbGVtZW50IHtcbiAgcmVhZG9ubHkgYnVpbGRlcjogQnVpbGRlcjtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYmFzZTogQnVpbGRCYXNlRWxlbWVudCkge1xuICAgIHRoaXMuYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7XG4gIH1cblxuICBzaW1wbGUodGFnOiBTb3VyY2VTbGljZSwgYm9keTogQVNUdjIuQ29udGVudE5vZGVbXSwgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuU2ltcGxlRWxlbWVudCB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5TaW1wbGVFbGVtZW50KFxuICAgICAgYXNzaWduKFxuICAgICAgICB7XG4gICAgICAgICAgdGFnLFxuICAgICAgICAgIGJvZHksXG4gICAgICAgICAgY29tcG9uZW50QXJnczogW10sXG4gICAgICAgICAgbG9jLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmJhc2VcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgbmFtZWQobmFtZTogU291cmNlU2xpY2UsIGJsb2NrOiBBU1R2Mi5CbG9jaywgbG9jOiBTb3VyY2VTcGFuKTogQVNUdjIuTmFtZWRCbG9jayB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5OYW1lZEJsb2NrKFxuICAgICAgYXNzaWduKFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBibG9jayxcbiAgICAgICAgICBjb21wb25lbnRBcmdzOiBbXSxcbiAgICAgICAgICBsb2MsXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuYmFzZVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBzZWxmQ2xvc2luZ0NvbXBvbmVudChjYWxsZWU6IEFTVHYyLkV4cHJlc3Npb25Ob2RlLCBsb2M6IFNvdXJjZVNwYW4pOiBBU1R2Mi5JbnZva2VDb21wb25lbnQge1xuICAgIHJldHVybiBuZXcgQVNUdjIuSW52b2tlQ29tcG9uZW50KFxuICAgICAgYXNzaWduKFxuICAgICAgICB7XG4gICAgICAgICAgbG9jLFxuICAgICAgICAgIGNhbGxlZSxcbiAgICAgICAgICAvLyBwb2ludCB0aGUgZW1wdHkgbmFtZWQgYmxvY2tzIGF0IHRoZSBgL2Agc2VsZi1jbG9zaW5nIHRhZ1xuICAgICAgICAgIGJsb2NrczogbmV3IEFTVHYyLk5hbWVkQmxvY2tzKHtcbiAgICAgICAgICAgIGJsb2NrczogW10sXG4gICAgICAgICAgICBsb2M6IGxvYy5zbGljZUVuZENoYXJzKHsgc2tpcEVuZDogMSwgY2hhcnM6IDEgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuYmFzZVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBjb21wb25lbnRXaXRoRGVmYXVsdEJsb2NrKFxuICAgIGNhbGxlZTogQVNUdjIuRXhwcmVzc2lvbk5vZGUsXG4gICAgY2hpbGRyZW46IEFTVHYyLkNvbnRlbnROb2RlW10sXG4gICAgc3ltYm9sczogQmxvY2tTeW1ib2xUYWJsZSxcbiAgICBsb2M6IFNvdXJjZVNwYW5cbiAgKTogQVNUdjIuSW52b2tlQ29tcG9uZW50IHtcbiAgICBsZXQgYmxvY2sgPSB0aGlzLmJ1aWxkZXIuYmxvY2soc3ltYm9scywgY2hpbGRyZW4sIGxvYyk7XG4gICAgbGV0IG5hbWVkQmxvY2sgPSB0aGlzLmJ1aWxkZXIubmFtZWRCbG9jayhTb3VyY2VTbGljZS5zeW50aGV0aWMoJ2RlZmF1bHQnKSwgYmxvY2ssIGxvYyk7IC8vIEJVSUxERVIuc2ltcGxlTmFtZWRCbG9jaygnZGVmYXVsdCcsIGNoaWxkcmVuLCBzeW1ib2xzLCBsb2MpO1xuXG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5JbnZva2VDb21wb25lbnQoXG4gICAgICBhc3NpZ24oXG4gICAgICAgIHtcbiAgICAgICAgICBsb2MsXG4gICAgICAgICAgY2FsbGVlLFxuICAgICAgICAgIGJsb2NrczogdGhpcy5idWlsZGVyLm5hbWVkQmxvY2tzKFtuYW1lZEJsb2NrXSwgbmFtZWRCbG9jay5sb2MpLFxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmJhc2VcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgY29tcG9uZW50V2l0aE5hbWVkQmxvY2tzKFxuICAgIGNhbGxlZTogQVNUdjIuRXhwcmVzc2lvbk5vZGUsXG4gICAgYmxvY2tzOiBQcmVzZW50QXJyYXk8QVNUdjIuTmFtZWRCbG9jaz4sXG4gICAgbG9jOiBTb3VyY2VTcGFuXG4gICk6IEFTVHYyLkludm9rZUNvbXBvbmVudCB7XG4gICAgcmV0dXJuIG5ldyBBU1R2Mi5JbnZva2VDb21wb25lbnQoXG4gICAgICBhc3NpZ24oXG4gICAgICAgIHtcbiAgICAgICAgICBsb2MsXG4gICAgICAgICAgY2FsbGVlLFxuICAgICAgICAgIGJsb2NrczogdGhpcy5idWlsZGVyLm5hbWVkQmxvY2tzKGJsb2NrcywgU3Bhbkxpc3QucmFuZ2UoYmxvY2tzKSksXG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMuYmFzZVxuICAgICAgKVxuICAgICk7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=