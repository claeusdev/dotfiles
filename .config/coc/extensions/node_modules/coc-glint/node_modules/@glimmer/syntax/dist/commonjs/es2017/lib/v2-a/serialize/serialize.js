"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ContentSerializer = exports.ExprSerializer = exports.RefSerializer = void 0;

var _slice = require("../../source/slice");

class RefSerializer {
  arg(ref) {
    return {
      type: 'Arg',
      loc: ref.loc.serialize(),
      name: ref.name.serialize()
    };
  }

  free(ref) {
    return {
      type: 'Free',
      loc: ref.loc.serialize(),
      resolution: ref.resolution.serialize(),
      name: ref.name
    };
  }

  local(ref) {
    return {
      type: 'Local',
      loc: ref.loc.serialize(),
      name: ref.name
    };
  }

  self(ref) {
    return {
      type: 'This',
      loc: ref.loc.serialize()
    };
  }

}

exports.RefSerializer = RefSerializer;
const REF = new RefSerializer();

class ExprSerializer {
  literal(literal) {
    return {
      type: 'Literal',
      loc: literal.loc.serialize(),
      value: literal.value
    };
  }

  path(path) {
    return {
      type: 'Path',
      loc: path.loc.serialize(),
      ref: visit.ref(path.ref),
      tail: path.tail.map(t => t.serialize())
    };
  }

  call(call) {
    return {
      type: 'Call',
      loc: call.loc.serialize(),
      callee: visit.expr(call.callee),
      args: ARGS.args(call.args)
    };
  }

  interpolate(interpolate) {
    return {
      type: 'Interpolate',
      loc: interpolate.loc.serialize(),
      parts: interpolate.parts.map(p => visit.expr(p))
    };
  }

}

exports.ExprSerializer = ExprSerializer;
const EXPR = new ExprSerializer();

class ArgsSerializer {
  args(args) {
    return {
      loc: args.loc.serialize(),
      positional: this.positional(args.positional),
      named: this.named(args.named)
    };
  }

  positional(positional) {
    return {
      loc: positional.loc.serialize(),
      exprs: positional.exprs.map(p => visit.expr(p))
    };
  }

  named(named) {
    return {
      loc: named.loc.serialize(),
      entries: named.entries.map(e => this.entry(e))
    };
  }

  entry(entry) {
    return [entry.name.serialize(), visit.expr(entry.value)];
  }

}

const ARGS = new ArgsSerializer();

class ContentSerializer {
  append(node) {
    return {
      type: 'Append',
      loc: node.loc.serialize(),
      value: visit.expr(node.value),
      trusting: node.trusting
    };
  }

  glimmerComment(node) {
    return {
      type: 'GlimmerComment',
      loc: node.loc.serialize(),
      text: node.text.serialize()
    };
  }

  htmlComment(node) {
    return {
      type: 'HtmlComment',
      loc: node.loc.serialize(),
      text: node.text.serialize()
    };
  }

  htmlText(node) {
    return {
      type: 'HtmlText',
      loc: node.loc.serialize(),
      chars: node.chars
    };
  }

  invokeBlock(node) {
    let args = ARGS.args(node.args);
    let callee = visit.expr(node.callee);
    return {
      type: 'InvokeBlock',
      loc: node.loc.serialize(),
      args,
      callee,
      blocks: INTERNAL.namedBlocks(node.blocks)
    };
  }

  invokeComponent(node) {
    return {
      type: 'InvokeComponent',
      loc: node.loc.serialize(),
      callee: visit.expr(node.callee),
      blocks: INTERNAL.namedBlocks(node.blocks),
      attrs: node.attrs.map(a => visit.attr(a)),
      componentArgs: node.componentArgs.map(a => ATTRS.arg(a)),
      modifiers: node.modifiers.map(m => ATTRS.modifier(m))
    };
  }

  simpleElement(node) {
    return {
      type: 'SimpleElement',
      loc: node.loc.serialize(),
      tag: node.tag.serialize(),
      body: node.body.map(b => visit.content(b)),
      attrs: node.attrs.map(a => visit.attr(a)),
      componentArgs: node.componentArgs.map(a => ATTRS.arg(a)),
      modifiers: node.modifiers.map(m => ATTRS.modifier(m))
    };
  }

}

exports.ContentSerializer = ContentSerializer;
const CONTENT = new ContentSerializer();

class AttrBlockSerializer {
  modifier(node) {
    return {
      loc: node.loc.serialize(),
      callee: visit.expr(node.callee),
      args: ARGS.args(node.args)
    };
  }

  arg(node) {
    return this.anyAttr(node);
  }

  anyAttr(node) {
    return {
      loc: node.loc.serialize(),
      name: node.name.serialize(),
      value: visit.expr(node.value),
      trusting: node.trusting
    };
  }

}

const ATTRS = new AttrBlockSerializer();

class InternalSerializer {
  block(node) {
    return {
      loc: node.loc.serialize(),
      body: node.body.map(b => visit.content(b)),
      table: node.scope.locals
    };
  }

  namedBlock(node) {
    return {
      name: node.name.serialize(),
      block: INTERNAL.block(node.block)
    };
  }

  namedBlocks(node) {
    return {
      blocks: node.blocks.map(b => INTERNAL.namedBlock(b)),
      loc: node.loc.serialize()
    };
  }

}

const INTERNAL = new InternalSerializer();
const visit = {
  expr(expr) {
    switch (expr.type) {
      case 'Literal':
        return EXPR.literal(expr);

      case 'Path':
        return EXPR.path(expr);

      case 'Call':
        return EXPR.call(expr);

      case 'Interpolate':
        return EXPR.interpolate(expr);
    }
  },

  attr(node) {
    if (node.type === 'SplatAttr') {
      return new _slice.SourceSlice({
        loc: node.loc,
        chars: '...attributes'
      }).serialize();
    } else {
      return ATTRS.anyAttr(node);
    }
  },

  ref(ref) {
    switch (ref.type) {
      case 'Arg':
        return REF.arg(ref);

      case 'Free':
        return REF.free(ref);

      case 'Local':
        return REF.local(ref);

      case 'This':
        return REF.self(ref);
    }
  },

  content(node) {
    switch (node.type) {
      case 'AppendContent':
        return CONTENT.append(node);

      case 'GlimmerComment':
        return CONTENT.glimmerComment(node);

      case 'HtmlComment':
        return CONTENT.htmlComment(node);

      case 'HtmlText':
        return CONTENT.htmlText(node);

      case 'InvokeBlock':
        return CONTENT.invokeBlock(node);

      case 'InvokeComponent':
        return CONTENT.invokeComponent(node);

      case 'SimpleElement':
        return CONTENT.simpleElement(node);
    }
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvdjItYS9zZXJpYWxpemUvc2VyaWFsaXplLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFpQ00sTUFBQSxhQUFBLENBQW9CO0FBQ3hCLEVBQUEsR0FBRyxDQUFBLEdBQUEsRUFBd0I7QUFDekIsV0FBTztBQUNMLE1BQUEsSUFBSSxFQURDLEtBQUE7QUFFTCxNQUFBLEdBQUcsRUFBRSxHQUFHLENBQUgsR0FBQSxDQUZBLFNBRUEsRUFGQTtBQUdMLE1BQUEsSUFBSSxFQUFFLEdBQUcsQ0FBSCxJQUFBLENBQUEsU0FBQTtBQUhELEtBQVA7QUFLRDs7QUFFRCxFQUFBLElBQUksQ0FBQSxHQUFBLEVBQTRCO0FBQzlCLFdBQU87QUFDTCxNQUFBLElBQUksRUFEQyxNQUFBO0FBRUwsTUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFILEdBQUEsQ0FGQSxTQUVBLEVBRkE7QUFHTCxNQUFBLFVBQVUsRUFBRSxHQUFHLENBQUgsVUFBQSxDQUhQLFNBR08sRUFIUDtBQUlMLE1BQUEsSUFBSSxFQUFFLEdBQUcsQ0FBQztBQUpMLEtBQVA7QUFNRDs7QUFFRCxFQUFBLEtBQUssQ0FBQSxHQUFBLEVBQTZCO0FBQ2hDLFdBQU87QUFDTCxNQUFBLElBQUksRUFEQyxPQUFBO0FBRUwsTUFBQSxHQUFHLEVBQUUsR0FBRyxDQUFILEdBQUEsQ0FGQSxTQUVBLEVBRkE7QUFHTCxNQUFBLElBQUksRUFBRSxHQUFHLENBQUM7QUFITCxLQUFQO0FBS0Q7O0FBRUQsRUFBQSxJQUFJLENBQUEsR0FBQSxFQUF5QjtBQUMzQixXQUFPO0FBQ0wsTUFBQSxJQUFJLEVBREMsTUFBQTtBQUVMLE1BQUEsR0FBRyxFQUFFLEdBQUcsQ0FBSCxHQUFBLENBQUEsU0FBQTtBQUZBLEtBQVA7QUFJRDs7QUEvQnVCOzs7QUFrQzFCLE1BQU0sR0FBRyxHQUFHLElBQVosYUFBWSxFQUFaOztBQUVNLE1BQUEs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QUE7QUFDRSxXQUFBLGVBQUE7QUFDRSxlQUFPLE9BQU8sQ0FBUCxNQUFBLENBQVAsSUFBTyxDQUFQOztBQUNGLFdBQUEsZ0JBQUE7QUFDRSxlQUFPLE9BQU8sQ0FBUCxjQUFBLENBQVAsSUFBTyxDQUFQOztBQUNGLFdBQUEsYUFBQTtBQUNFLGVBQU8sT0FBTyxDQUFQLFdBQUEsQ0FBUCxJQUFPLENBQVA7O0FBQ0YsV0FBQSxVQUFBO0FBQ0UsZUFBTyxPQUFPLENBQVAsUUFBQSxDQUFQLElBQU8sQ0FBUDs7QUFDRixXQUFBLGFBQUE7QUFDRSxlQUFPLE9BQU8sQ0FBUCxXQUFBLENBQVAsSUFBTyxDQUFQOztBQUNGLFdBQUEsaUJBQUE7QUFDRSxlQUFPLE9BQU8sQ0FBUCxlQUFBLENBQVAsSUFBTyxDQUFQOztBQUNGLFdBQUEsZUFBQTtBQUNFLGVBQU8sT0FBTyxDQUFQLGFBQUEsQ0FBUCxJQUFPLENBQVA7QUFkSjtBQWdCRDs7QUFwRFcsQ0FBZCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByZXNlbnRBcnJheSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuXG5pbXBvcnQgeyBTb3VyY2VTbGljZSB9IGZyb20gJy4uLy4uL3NvdXJjZS9zbGljZSc7XG5pbXBvcnQgKiBhcyBBU1R2MiBmcm9tICcuLi9hcGknO1xuaW1wb3J0IHR5cGUge1xuICBTZXJpYWxpemVkQXBwZW5kQ29udGVudCxcbiAgU2VyaWFsaXplZEFyZ1JlZmVyZW5jZSxcbiAgU2VyaWFsaXplZEFyZ3MsXG4gIFNlcmlhbGl6ZWRBdHRyT3JBcmcsXG4gIFNlcmlhbGl6ZWRCbG9jayxcbiAgU2VyaWFsaXplZENhbGxFeHByZXNzaW9uLFxuICBTZXJpYWxpemVkQ29udGVudE5vZGUsXG4gIFNlcmlhbGl6ZWRFbGVtZW50TW9kaWZpZXIsXG4gIFNlcmlhbGl6ZWRFeHByZXNzaW9uTm9kZSxcbiAgU2VyaWFsaXplZEZyZWVWYXJSZWZlcmVuY2UsXG4gIFNlcmlhbGl6ZWRHbGltbWVyQ29tbWVudCxcbiAgU2VyaWFsaXplZEh0bWxDb21tZW50LFxuICBTZXJpYWxpemVkSHRtbE9yU3BsYXRBdHRyLFxuICBTZXJpYWxpemVkSHRtbFRleHQsXG4gIFNlcmlhbGl6ZWRJbnRlcnBvbGF0ZUV4cHJlc3Npb24sXG4gIFNlcmlhbGl6ZWRJbnZva2VCbG9jayxcbiAgU2VyaWFsaXplZEludm9rZUNvbXBvbmVudCxcbiAgU2VyaWFsaXplZExpdGVyYWxFeHByZXNzaW9uLFxuICBTZXJpYWxpemVkTG9jYWxWYXJSZWZlcmVuY2UsXG4gIFNlcmlhbGl6ZWROYW1lZCxcbiAgU2VyaWFsaXplZE5hbWVkQXJndW1lbnQsXG4gIFNlcmlhbGl6ZWROYW1lZEJsb2NrLFxuICBTZXJpYWxpemVkTmFtZWRCbG9ja3MsXG4gIFNlcmlhbGl6ZWRQYXRoRXhwcmVzc2lvbixcbiAgU2VyaWFsaXplZFBvc2l0aW9uYWwsXG4gIFNlcmlhbGl6ZWRTaW1wbGVFbGVtZW50LFxuICBTZXJpYWxpemVkVGhpc1JlZmVyZW5jZSxcbiAgU2VyaWFsaXplZFZhcmlhYmxlUmVmZXJlbmNlLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGNsYXNzIFJlZlNlcmlhbGl6ZXIge1xuICBhcmcocmVmOiBBU1R2Mi5BcmdSZWZlcmVuY2UpOiBTZXJpYWxpemVkQXJnUmVmZXJlbmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0FyZycsXG4gICAgICBsb2M6IHJlZi5sb2Muc2VyaWFsaXplKCksXG4gICAgICBuYW1lOiByZWYubmFtZS5zZXJpYWxpemUoKSxcbiAgICB9O1xuICB9XG5cbiAgZnJlZShyZWY6IEFTVHYyLkZyZWVWYXJSZWZlcmVuY2UpOiBTZXJpYWxpemVkRnJlZVZhclJlZmVyZW5jZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdGcmVlJyxcbiAgICAgIGxvYzogcmVmLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHJlc29sdXRpb246IHJlZi5yZXNvbHV0aW9uLnNlcmlhbGl6ZSgpLFxuICAgICAgbmFtZTogcmVmLm5hbWUsXG4gICAgfTtcbiAgfVxuXG4gIGxvY2FsKHJlZjogQVNUdjIuTG9jYWxWYXJSZWZlcmVuY2UpOiBTZXJpYWxpemVkTG9jYWxWYXJSZWZlcmVuY2Uge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnTG9jYWwnLFxuICAgICAgbG9jOiByZWYubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgbmFtZTogcmVmLm5hbWUsXG4gICAgfTtcbiAgfVxuXG4gIHNlbGYocmVmOiBBU1R2Mi5UaGlzUmVmZXJlbmNlKTogU2VyaWFsaXplZFRoaXNSZWZlcmVuY2Uge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnVGhpcycsXG4gICAgICBsb2M6IHJlZi5sb2Muc2VyaWFsaXplKCksXG4gICAgfTtcbiAgfVxufVxuXG5jb25zdCBSRUYgPSBuZXcgUmVmU2VyaWFsaXplcigpO1xuXG5leHBvcnQgY2xhc3MgRXhwclNlcmlhbGl6ZXIge1xuICBsaXRlcmFsKGxpdGVyYWw6IEFTVHYyLkxpdGVyYWxFeHByZXNzaW9uKTogU2VyaWFsaXplZExpdGVyYWxFeHByZXNzaW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0xpdGVyYWwnLFxuICAgICAgbG9jOiBsaXRlcmFsLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHZhbHVlOiBsaXRlcmFsLnZhbHVlLFxuICAgIH07XG4gIH1cblxuICBwYXRoKHBhdGg6IEFTVHYyLlBhdGhFeHByZXNzaW9uKTogU2VyaWFsaXplZFBhdGhFeHByZXNzaW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ1BhdGgnLFxuICAgICAgbG9jOiBwYXRoLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHJlZjogdmlzaXQucmVmKHBhdGgucmVmKSxcbiAgICAgIHRhaWw6IHBhdGgudGFpbC5tYXAoKHQpID0+IHQuc2VyaWFsaXplKCkpLFxuICAgIH07XG4gIH1cblxuICBjYWxsKGNhbGw6IEFTVHYyLkNhbGxFeHByZXNzaW9uKTogU2VyaWFsaXplZENhbGxFeHByZXNzaW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0NhbGwnLFxuICAgICAgbG9jOiBjYWxsLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIGNhbGxlZTogdmlzaXQuZXhwcihjYWxsLmNhbGxlZSksXG4gICAgICBhcmdzOiBBUkdTLmFyZ3MoY2FsbC5hcmdzKSxcbiAgICB9O1xuICB9XG5cbiAgaW50ZXJwb2xhdGUoaW50ZXJwb2xhdGU6IEFTVHYyLkludGVycG9sYXRlRXhwcmVzc2lvbik6IFNlcmlhbGl6ZWRJbnRlcnBvbGF0ZUV4cHJlc3Npb24ge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnSW50ZXJwb2xhdGUnLFxuICAgICAgbG9jOiBpbnRlcnBvbGF0ZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBwYXJ0czogaW50ZXJwb2xhdGUucGFydHMubWFwKChwKSA9PiB2aXNpdC5leHByKHApKSBhcyBQcmVzZW50QXJyYXk8U2VyaWFsaXplZEV4cHJlc3Npb25Ob2RlPixcbiAgICB9O1xuICB9XG59XG5cbmNvbnN0IEVYUFIgPSBuZXcgRXhwclNlcmlhbGl6ZXIoKTtcblxuY2xhc3MgQXJnc1NlcmlhbGl6ZXIge1xuICBhcmdzKGFyZ3M6IEFTVHYyLkFyZ3MpOiBTZXJpYWxpemVkQXJncyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYzogYXJncy5sb2Muc2VyaWFsaXplKCksXG4gICAgICBwb3NpdGlvbmFsOiB0aGlzLnBvc2l0aW9uYWwoYXJncy5wb3NpdGlvbmFsKSxcbiAgICAgIG5hbWVkOiB0aGlzLm5hbWVkKGFyZ3MubmFtZWQpLFxuICAgIH07XG4gIH1cblxuICBwb3NpdGlvbmFsKHBvc2l0aW9uYWw6IEFTVHYyLlBvc2l0aW9uYWxBcmd1bWVudHMpOiBTZXJpYWxpemVkUG9zaXRpb25hbCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYzogcG9zaXRpb25hbC5sb2Muc2VyaWFsaXplKCksXG4gICAgICBleHByczogcG9zaXRpb25hbC5leHBycy5tYXAoKHApID0+IHZpc2l0LmV4cHIocCkpLFxuICAgIH07XG4gIH1cblxuICBuYW1lZChuYW1lZDogQVNUdjIuTmFtZWRBcmd1bWVudHMpOiBTZXJpYWxpemVkTmFtZWQge1xuICAgIHJldHVybiB7XG4gICAgICBsb2M6IG5hbWVkLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIGVudHJpZXM6IG5hbWVkLmVudHJpZXMubWFwKChlKSA9PiB0aGlzLmVudHJ5KGUpKSxcbiAgICB9O1xuICB9XG5cbiAgZW50cnkoZW50cnk6IEFTVHYyLk5hbWVkQXJndW1lbnQpOiBTZXJpYWxpemVkTmFtZWRBcmd1bWVudCB7XG4gICAgcmV0dXJuIFtlbnRyeS5uYW1lLnNlcmlhbGl6ZSgpLCB2aXNpdC5leHByKGVudHJ5LnZhbHVlKV07XG4gIH1cbn1cblxuY29uc3QgQVJHUyA9IG5ldyBBcmdzU2VyaWFsaXplcigpO1xuXG5leHBvcnQgY2xhc3MgQ29udGVudFNlcmlhbGl6ZXIge1xuICBhcHBlbmQobm9kZTogQVNUdjIuQXBwZW5kQ29udGVudCk6IFNlcmlhbGl6ZWRBcHBlbmRDb250ZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0FwcGVuZCcsXG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgdmFsdWU6IHZpc2l0LmV4cHIobm9kZS52YWx1ZSksXG4gICAgICB0cnVzdGluZzogbm9kZS50cnVzdGluZyxcbiAgICB9O1xuICB9XG5cbiAgZ2xpbW1lckNvbW1lbnQobm9kZTogQVNUdjIuR2xpbW1lckNvbW1lbnQpOiBTZXJpYWxpemVkR2xpbW1lckNvbW1lbnQge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnR2xpbW1lckNvbW1lbnQnLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHRleHQ6IG5vZGUudGV4dC5zZXJpYWxpemUoKSxcbiAgICB9O1xuICB9XG5cbiAgaHRtbENvbW1lbnQobm9kZTogQVNUdjIuSHRtbENvbW1lbnQpOiBTZXJpYWxpemVkSHRtbENvbW1lbnQge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnSHRtbENvbW1lbnQnLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIHRleHQ6IG5vZGUudGV4dC5zZXJpYWxpemUoKSxcbiAgICB9O1xuICB9XG5cbiAgaHRtbFRleHQobm9kZTogQVNUdjIuSHRtbFRleHQpOiBTZXJpYWxpemVkSHRtbFRleHQge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnSHRtbFRleHQnLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIGNoYXJzOiBub2RlLmNoYXJzLFxuICAgIH07XG4gIH1cblxuICBpbnZva2VCbG9jayhub2RlOiBBU1R2Mi5JbnZva2VCbG9jayk6IFNlcmlhbGl6ZWRJbnZva2VCbG9jayB7XG4gICAgbGV0IGFyZ3MgPSBBUkdTLmFyZ3Mobm9kZS5hcmdzKTtcbiAgICBsZXQgY2FsbGVlID0gdmlzaXQuZXhwcihub2RlLmNhbGxlZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0ludm9rZUJsb2NrJyxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBhcmdzLFxuICAgICAgY2FsbGVlLFxuICAgICAgYmxvY2tzOiBJTlRFUk5BTC5uYW1lZEJsb2Nrcyhub2RlLmJsb2NrcyksXG4gICAgfTtcbiAgfVxuXG4gIGludm9rZUNvbXBvbmVudChub2RlOiBBU1R2Mi5JbnZva2VDb21wb25lbnQpOiBTZXJpYWxpemVkSW52b2tlQ29tcG9uZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ0ludm9rZUNvbXBvbmVudCcsXG4gICAgICBsb2M6IG5vZGUubG9jLnNlcmlhbGl6ZSgpLFxuICAgICAgY2FsbGVlOiB2aXNpdC5leHByKG5vZGUuY2FsbGVlKSxcbiAgICAgIGJsb2NrczogSU5URVJOQUwubmFtZWRCbG9ja3Mobm9kZS5ibG9ja3MpLFxuICAgICAgYXR0cnM6IG5vZGUuYXR0cnMubWFwKChhKSA9PiB2aXNpdC5hdHRyKGEpKSxcbiAgICAgIGNvbXBvbmVudEFyZ3M6IG5vZGUuY29tcG9uZW50QXJncy5tYXAoKGEpID0+IEFUVFJTLmFyZyhhKSksXG4gICAgICBtb2RpZmllcnM6IG5vZGUubW9kaWZpZXJzLm1hcCgobSkgPT4gQVRUUlMubW9kaWZpZXIobSkpLFxuICAgIH07XG4gIH1cblxuICBzaW1wbGVFbGVtZW50KG5vZGU6IEFTVHYyLlNpbXBsZUVsZW1lbnQpOiBTZXJpYWxpemVkU2ltcGxlRWxlbWVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdTaW1wbGVFbGVtZW50JyxcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICB0YWc6IG5vZGUudGFnLnNlcmlhbGl6ZSgpLFxuICAgICAgYm9keTogbm9kZS5ib2R5Lm1hcCgoYikgPT4gdmlzaXQuY29udGVudChiKSksXG4gICAgICBhdHRyczogbm9kZS5hdHRycy5tYXAoKGEpID0+IHZpc2l0LmF0dHIoYSkpLFxuICAgICAgY29tcG9uZW50QXJnczogbm9kZS5jb21wb25lbnRBcmdzLm1hcCgoYSkgPT4gQVRUUlMuYXJnKGEpKSxcbiAgICAgIG1vZGlmaWVyczogbm9kZS5tb2RpZmllcnMubWFwKChtKSA9PiBBVFRSUy5tb2RpZmllcihtKSksXG4gICAgfTtcbiAgfVxufVxuXG5jb25zdCBDT05URU5UID0gbmV3IENvbnRlbnRTZXJpYWxpemVyKCk7XG5cbmNsYXNzIEF0dHJCbG9ja1NlcmlhbGl6ZXIge1xuICBtb2RpZmllcihub2RlOiBBU1R2Mi5FbGVtZW50TW9kaWZpZXIpOiBTZXJpYWxpemVkRWxlbWVudE1vZGlmaWVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICAgIGNhbGxlZTogdmlzaXQuZXhwcihub2RlLmNhbGxlZSksXG4gICAgICBhcmdzOiBBUkdTLmFyZ3Mobm9kZS5hcmdzKSxcbiAgICB9O1xuICB9XG5cbiAgYXJnKG5vZGU6IEFTVHYyLkNvbXBvbmVudEFyZyk6IFNlcmlhbGl6ZWRBdHRyT3JBcmcge1xuICAgIHJldHVybiB0aGlzLmFueUF0dHIobm9kZSk7XG4gIH1cblxuICBhbnlBdHRyKG5vZGU6IEFTVHYyLkNvbXBvbmVudEFyZyB8IEFTVHYyLkh0bWxBdHRyKTogU2VyaWFsaXplZEF0dHJPckFyZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBuYW1lOiBub2RlLm5hbWUuc2VyaWFsaXplKCksXG4gICAgICB2YWx1ZTogdmlzaXQuZXhwcihub2RlLnZhbHVlKSxcbiAgICAgIHRydXN0aW5nOiBub2RlLnRydXN0aW5nLFxuICAgIH07XG4gIH1cbn1cblxuY29uc3QgQVRUUlMgPSBuZXcgQXR0ckJsb2NrU2VyaWFsaXplcigpO1xuXG5jbGFzcyBJbnRlcm5hbFNlcmlhbGl6ZXIge1xuICBibG9jayhub2RlOiBBU1R2Mi5CbG9jayk6IFNlcmlhbGl6ZWRCbG9jayB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYzogbm9kZS5sb2Muc2VyaWFsaXplKCksXG4gICAgICBib2R5OiBub2RlLmJvZHkubWFwKChiKSA9PiB2aXNpdC5jb250ZW50KGIpKSxcbiAgICAgIHRhYmxlOiBub2RlLnNjb3BlLmxvY2FscyxcbiAgICB9O1xuICB9XG5cbiAgbmFtZWRCbG9jayhub2RlOiBBU1R2Mi5OYW1lZEJsb2NrKTogU2VyaWFsaXplZE5hbWVkQmxvY2sge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBub2RlLm5hbWUuc2VyaWFsaXplKCksXG4gICAgICBibG9jazogSU5URVJOQUwuYmxvY2sobm9kZS5ibG9jayksXG4gICAgfTtcbiAgfVxuXG4gIG5hbWVkQmxvY2tzKG5vZGU6IEFTVHYyLk5hbWVkQmxvY2tzKTogU2VyaWFsaXplZE5hbWVkQmxvY2tzIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmxvY2tzOiBub2RlLmJsb2Nrcy5tYXAoKGIpID0+IElOVEVSTkFMLm5hbWVkQmxvY2soYikpLFxuICAgICAgbG9jOiBub2RlLmxvYy5zZXJpYWxpemUoKSxcbiAgICB9O1xuICB9XG59XG5cbmNvbnN0IElOVEVSTkFMID0gbmV3IEludGVybmFsU2VyaWFsaXplcigpO1xuXG5jb25zdCB2aXNpdCA9IHtcbiAgZXhwcihleHByOiBBU1R2Mi5FeHByZXNzaW9uTm9kZSk6IFNlcmlhbGl6ZWRFeHByZXNzaW9uTm9kZSB7XG4gICAgc3dpdGNoIChleHByLnR5cGUpIHtcbiAgICAgIGNhc2UgJ0xpdGVyYWwnOlxuICAgICAgICByZXR1cm4gRVhQUi5saXRlcmFsKGV4cHIpO1xuICAgICAgY2FzZSAnUGF0aCc6XG4gICAgICAgIHJldHVybiBFWFBSLnBhdGgoZXhwcik7XG4gICAgICBjYXNlICdDYWxsJzpcbiAgICAgICAgcmV0dXJuIEVYUFIuY2FsbChleHByKTtcbiAgICAgIGNhc2UgJ0ludGVycG9sYXRlJzpcbiAgICAgICAgcmV0dXJuIEVYUFIuaW50ZXJwb2xhdGUoZXhwcik7XG4gICAgfVxuICB9LFxuXG4gIGF0dHIobm9kZTogQVNUdjIuSHRtbE9yU3BsYXRBdHRyKTogU2VyaWFsaXplZEh0bWxPclNwbGF0QXR0ciB7XG4gICAgaWYgKG5vZGUudHlwZSA9PT0gJ1NwbGF0QXR0cicpIHtcbiAgICAgIHJldHVybiBuZXcgU291cmNlU2xpY2UoeyBsb2M6IG5vZGUubG9jLCBjaGFyczogJy4uLmF0dHJpYnV0ZXMnIH0pLnNlcmlhbGl6ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gQVRUUlMuYW55QXR0cihub2RlKTtcbiAgICB9XG4gIH0sXG5cbiAgcmVmKHJlZjogQVNUdjIuVmFyaWFibGVSZWZlcmVuY2UpOiBTZXJpYWxpemVkVmFyaWFibGVSZWZlcmVuY2Uge1xuICAgIHN3aXRjaCAocmVmLnR5cGUpIHtcbiAgICAgIGNhc2UgJ0FyZyc6XG4gICAgICAgIHJldHVybiBSRUYuYXJnKHJlZik7XG4gICAgICBjYXNlICdGcmVlJzpcbiAgICAgICAgcmV0dXJuIFJFRi5mcmVlKHJlZik7XG4gICAgICBjYXNlICdMb2NhbCc6XG4gICAgICAgIHJldHVybiBSRUYubG9jYWwocmVmKTtcbiAgICAgIGNhc2UgJ1RoaXMnOlxuICAgICAgICByZXR1cm4gUkVGLnNlbGYocmVmKTtcbiAgICB9XG4gIH0sXG5cbiAgY29udGVudChub2RlOiBBU1R2Mi5Db250ZW50Tm9kZSk6IFNlcmlhbGl6ZWRDb250ZW50Tm9kZSB7XG4gICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICAgIGNhc2UgJ0FwcGVuZENvbnRlbnQnOlxuICAgICAgICByZXR1cm4gQ09OVEVOVC5hcHBlbmQobm9kZSk7XG4gICAgICBjYXNlICdHbGltbWVyQ29tbWVudCc6XG4gICAgICAgIHJldHVybiBDT05URU5ULmdsaW1tZXJDb21tZW50KG5vZGUpO1xuICAgICAgY2FzZSAnSHRtbENvbW1lbnQnOlxuICAgICAgICByZXR1cm4gQ09OVEVOVC5odG1sQ29tbWVudChub2RlKTtcbiAgICAgIGNhc2UgJ0h0bWxUZXh0JzpcbiAgICAgICAgcmV0dXJuIENPTlRFTlQuaHRtbFRleHQobm9kZSk7XG4gICAgICBjYXNlICdJbnZva2VCbG9jayc6XG4gICAgICAgIHJldHVybiBDT05URU5ULmludm9rZUJsb2NrKG5vZGUpO1xuICAgICAgY2FzZSAnSW52b2tlQ29tcG9uZW50JzpcbiAgICAgICAgcmV0dXJuIENPTlRFTlQuaW52b2tlQ29tcG9uZW50KG5vZGUpO1xuICAgICAgY2FzZSAnU2ltcGxlRWxlbWVudCc6XG4gICAgICAgIHJldHVybiBDT05URU5ULnNpbXBsZUVsZW1lbnQobm9kZSk7XG4gICAgfVxuICB9LFxufTtcbiJdLCJzb3VyY2VSb290IjoiIn0=