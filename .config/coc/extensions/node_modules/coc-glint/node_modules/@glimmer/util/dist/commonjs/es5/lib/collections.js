"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.dict = dict;
exports.isDict = isDict;
exports.isObject = isObject;
exports.NonemptyStackImpl = exports.StackImpl = exports.DictSet = void 0;

var _guid = require("./guid");

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}

function dict() {
  return Object.create(null);
}

function isDict(u) {
  return u !== null && u !== undefined;
}

function isObject(u) {
  return typeof u === 'object' && u !== null;
}

var DictSet = /*#__PURE__*/function () {
  function DictSet() {
    this.dict = dict();
  }

  var _proto = DictSet.prototype;

  _proto.add = function add(obj) {
    if (typeof obj === 'string') this.dict[obj] = obj;else this.dict[(0, _guid.ensureGuid)(obj)] = obj;
    return this;
  };

  _proto["delete"] = function _delete(obj) {
    if (typeof obj === 'string') delete this.dict[obj];else if (obj._guid) delete this.dict[obj._guid];
  };

  return DictSet;
}();

exports.DictSet = DictSet;

var StackImpl = /*#__PURE__*/function () {
  function StackImpl(values) {
    if (values === void 0) {
      values = [];
    }

    this.current = null;
    this.stack = values;
  }

  var _proto2 = StackImpl.prototype;

  _proto2.push = function push(item) {
    this.current = item;
    this.stack.push(item);
  };

  _proto2.pop = function pop() {
    var item = this.stack.pop();
    var len = this.stack.length;
    this.current = len === 0 ? null : this.stack[len - 1];
    return item === undefined ? null : item;
  };

  _proto2.nth = function nth(from) {
    var len = this.stack.length;
    return len < from ? null : this.stack[len - from];
  };

  _proto2.isEmpty = function isEmpty() {
    return this.stack.length === 0;
  };

  _proto2.toArray = function toArray() {
    return this.stack;
  };

  _createClass(StackImpl, [{
    key: "size",
    get: function get() {
      return this.stack.length;
    }
  }]);

  return StackImpl;
}();

exports.StackImpl = StackImpl;

var NonemptyStackImpl = /*#__PURE__*/function () {
  function NonemptyStackImpl(values) {
    this.stack = values;
    this.current = values[values.length - 1];
  }

  var _proto3 = NonemptyStackImpl.prototype;

  _proto3.push = function push(item) {
    this.current = item;
    this.stack.push(item);
  };

  _proto3.pop = function pop() {
    if (this.stack.length === 1) {
      throw new Error("cannot pop the last element of a NonemptyStack");
    }

    var item = this.stack.pop();
    var len = this.stack.length;
    this.current = this.stack[len - 1];
    return item;
  };

  _proto3.nth = function nth(from) {
    var len = this.stack.length;
    return from >= len ? null : this.stack[from];
  };

  _proto3.nthBack = function nthBack(from) {
    var len = this.stack.length;
    return len < from ? null : this.stack[len - from];
  };

  _proto3.toArray = function toArray() {
    return this.stack;
  };

  _createClass(NonemptyStackImpl, [{
    key: "size",
    get: function get() {
      return this.stack.length;
    }
  }]);

  return NonemptyStackImpl;
}();

exports.NonemptyStackImpl = NonemptyStackImpl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3V0aWwvbGliL2NvbGxlY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBT00sU0FBQSxJQUFBLEdBQWM7QUFDbEIsU0FBTyxNQUFNLENBQU4sTUFBQSxDQUFQLElBQU8sQ0FBUDtBQUNEOztBQUVLLFNBQUEsTUFBQSxDQUFBLENBQUEsRUFBd0I7QUFDNUIsU0FBTyxDQUFDLEtBQUQsSUFBQSxJQUFjLENBQUMsS0FBdEIsU0FBQTtBQUNEOztBQUVLLFNBQUEsUUFBQSxDQUFBLENBQUEsRUFBMEI7QUFDOUIsU0FBTyxPQUFBLENBQUEsS0FBQSxRQUFBLElBQXlCLENBQUMsS0FBakMsSUFBQTtBQUNEOztBQUlELElBQU0sT0FBTixHQUFBLGFBQUEsWUFBQTtBQUdFLFdBQUEsT0FBQSxHQUFBO0FBQ0UsU0FBQSxJQUFBLEdBQVksSUFBWixFQUFBO0FBQ0Q7O0FBTEgsTUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLFNBQUE7O0FBQUEsRUFBQSxNQUFBLENBQUEsR0FBQSxHQU9FLFNBQUEsR0FBQSxDQUFBLEdBQUEsRUFBVTtBQUNSLFFBQUksT0FBQSxHQUFBLEtBQUosUUFBQSxFQUE2QixLQUFBLElBQUEsQ0FBQSxHQUFBLElBQTdCLEdBQTZCLENBQTdCLEtBQ0ssS0FBQSxJQUFBLENBQVUsc0JBQVYsR0FBVSxDQUFWLElBQUEsR0FBQTtBQUNMLFdBQUEsSUFBQTtBQVZKLEdBQUE7O0FBQUEsRUFBQSxNQUFBLENBQUEsUUFBQSxDQUFBLEdBYUUsU0FBQSxPQUFBLENBQUEsR0FBQSxFQUFhO0FBQ1gsUUFBSSxPQUFBLEdBQUEsS0FBSixRQUFBLEVBQTZCLE9BQU8sS0FBQSxJQUFBLENBQXBDLEdBQW9DLENBQVAsQ0FBN0IsS0FDSyxJQUFLLEdBQVcsQ0FBaEIsS0FBQSxFQUF3QixPQUFPLEtBQUEsSUFBQSxDQUFXLEdBQVcsQ0FBN0IsS0FB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QUEsQ0FBVyxHQUFHLEdBQTdCLENBQWUsQ0FBZjtBQUVBLFdBQUEsSUFBQTtBQTNCSixHQUFBOztBQUFBLEVBQUEsT0FBQSxDQUFBLEdBQUEsR0FnQ0UsU0FBQSxHQUFBLENBQUEsSUFBQSxFQUFnQjtBQUNkLFFBQUksR0FBRyxHQUFHLEtBQUEsS0FBQSxDQUFWLE1BQUE7QUFDQSxXQUFPLElBQUksSUFBSixHQUFBLEdBQUEsSUFBQSxHQUFxQixLQUFBLEtBQUEsQ0FBNUIsSUFBNEIsQ0FBNUI7QUFsQ0osR0FBQTs7QUFBQSxFQUFBLE9BQUEsQ0FBQSxPQUFBLEdBcUNFLFNBQUEsT0FBQSxDQUFBLElBQUEsRUFBb0I7QUFDbEIsUUFBSSxHQUFHLEdBQUcsS0FBQSxLQUFBLENBQVYsTUFBQTtBQUNBLFdBQU8sR0FBRyxHQUFILElBQUEsR0FBQSxJQUFBLEdBQW9CLEtBQUEsS0FBQSxDQUFXLEdBQUcsR0FBekMsSUFBMkIsQ0FBM0I7QUF2Q0osR0FBQTs7QUFBQSxFQUFBLE9BQUEsQ0FBQSxPQUFBLEdBMENFLFNBQUEsT0FBQSxHQUFPO0FBQ0wsV0FBTyxLQUFQLEtBQUE7QUEzQ0osR0FBQTs7QUFBQSxFQUFBLFlBQUEsQ0FBQSxpQkFBQSxFQUFBLENBQUE7QUFBQSxJQUFBLEdBQUEsRUFBQSxNQUFBO0FBQUEsSUFBQSxHQUFBLEVBQUEsU0FBQSxHQUFBLEdBU2lCO0FBQ2IsYUFBTyxLQUFBLEtBQUEsQ0FBUCxNQUFBO0FBQ0Q7QUFYSCxHQUFBLENBQUEsQ0FBQTs7QUFBQSxTQUFBLGlCQUFBO0FBQUEsQ0FBQSxFQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGljdCwgTm9uZW1wdHlTdGFjaywgT3B0aW9uLCBTdGFjayB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgZW5zdXJlR3VpZCwgSGFzR3VpZCB9IGZyb20gJy4vZ3VpZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2V0PFQ+IHtcbiAgYWRkKHZhbHVlOiBUKTogU2V0PFQ+O1xuICBkZWxldGUodmFsdWU6IFQpOiB2b2lkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGljdDxUID0gdW5rbm93bj4oKTogRGljdDxUPiB7XG4gIHJldHVybiBPYmplY3QuY3JlYXRlKG51bGwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEaWN0PFQ+KHU6IFQpOiB1IGlzIERpY3QgJiBUIHtcbiAgcmV0dXJuIHUgIT09IG51bGwgJiYgdSAhPT0gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3Q8VD4odTogVCk6IHUgaXMgb2JqZWN0ICYgVCB7XG4gIHJldHVybiB0eXBlb2YgdSA9PT0gJ29iamVjdCcgJiYgdSAhPT0gbnVsbDtcbn1cblxuZXhwb3J0IHR5cGUgU2V0TWVtYmVyID0gSGFzR3VpZCB8IHN0cmluZztcblxuZXhwb3J0IGNsYXNzIERpY3RTZXQ8VCBleHRlbmRzIFNldE1lbWJlcj4gaW1wbGVtZW50cyBTZXQ8VD4ge1xuICBwcml2YXRlIGRpY3Q6IERpY3Q8VD47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kaWN0ID0gZGljdDxUPigpO1xuICB9XG5cbiAgYWRkKG9iajogVCk6IFNldDxUPiB7XG4gICAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSB0aGlzLmRpY3Rbb2JqIGFzIGFueV0gPSBvYmo7XG4gICAgZWxzZSB0aGlzLmRpY3RbZW5zdXJlR3VpZChvYmogYXMgYW55KV0gPSBvYmo7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBkZWxldGUob2JqOiBUKSB7XG4gICAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSBkZWxldGUgdGhpcy5kaWN0W29iaiBhcyBhbnldO1xuICAgIGVsc2UgaWYgKChvYmogYXMgYW55KS5fZ3VpZCkgZGVsZXRlIHRoaXMuZGljdFsob2JqIGFzIGFueSkuX2d1aWRdO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTdGFja0ltcGw8VD4gaW1wbGVtZW50cyBTdGFjazxUPiB7XG4gIHByaXZhdGUgc3RhY2s6IFRbXTtcbiAgcHVibGljIGN1cnJlbnQ6IE9wdGlvbjxUPiA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IodmFsdWVzOiBUW10gPSBbXSkge1xuICAgIHRoaXMuc3RhY2sgPSB2YWx1ZXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhY2subGVuZ3RoO1xuICB9XG5cbiAgcHVzaChpdGVtOiBUKSB7XG4gICAgdGhpcy5jdXJyZW50ID0gaXRlbTtcbiAgICB0aGlzLnN0YWNrLnB1c2goaXRlbSk7XG4gIH1cblxuICBwb3AoKTogT3B0aW9uPFQ+IHtcbiAgICBsZXQgaXRlbSA9IHRoaXMuc3RhY2sucG9wKCk7XG4gICAgbGV0IGxlbiA9IHRoaXMuc3RhY2subGVuZ3RoO1xuICAgIHRoaXMuY3VycmVudCA9IGxlbiA9PT0gMCA/IG51bGwgOiB0aGlzLnN0YWNrW2xlbiAtIDFdO1xuXG4gICAgcmV0dXJuIGl0ZW0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBpdGVtO1xuICB9XG5cbiAgbnRoKGZyb206IG51bWJlcik6IE9wdGlvbjxUPiB7XG4gICAgbGV0IGxlbiA9IHRoaXMuc3RhY2subGVuZ3RoO1xuICAgIHJldHVybiBsZW4gPCBmcm9tID8gbnVsbCA6IHRoaXMuc3RhY2tbbGVuIC0gZnJvbV07XG4gIH1cblxuICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0YWNrLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIHRvQXJyYXkoKTogVFtdIHtcbiAgICByZXR1cm4gdGhpcy5zdGFjaztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTm9uZW1wdHlTdGFja0ltcGw8VD4gaW1wbGVtZW50cyBOb25lbXB0eVN0YWNrPFQ+IHtcbiAgcHJpdmF0ZSBzdGFjazogW1QsIC4uLlRbXV07XG4gIHB1YmxpYyBjdXJyZW50OiBUO1xuXG4gIGNvbnN0cnVjdG9yKHZhbHVlczogW1QsIC4uLlRbXV0pIHtcbiAgICB0aGlzLnN0YWNrID0gdmFsdWVzO1xuICAgIHRoaXMuY3VycmVudCA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV07XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNpemUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhY2subGVuZ3RoO1xuICB9XG5cbiAgcHVzaChpdGVtOiBUKSB7XG4gICAgdGhpcy5jdXJyZW50ID0gaXRlbTtcbiAgICB0aGlzLnN0YWNrLnB1c2goaXRlbSk7XG4gIH1cblxuICBwb3AoKTogVCB7XG4gICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID09PSAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGNhbm5vdCBwb3AgdGhlIGxhc3QgZWxlbWVudCBvZiBhIE5vbmVtcHR5U3RhY2tgKTtcbiAgICB9XG5cbiAgICBsZXQgaXRlbSA9IHRoaXMuc3RhY2sucG9wKCkhO1xuICAgIGxldCBsZW4gPSB0aGlzLnN0YWNrLmxlbmd0aDtcbiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnN0YWNrW2xlbiAtIDFdO1xuXG4gICAgcmV0dXJuIGl0ZW07XG4gIH1cblxuICBudGgoZnJvbTogMCk6IFQ7XG4gIG50aChmcm9tOiBudW1iZXIpOiBPcHRpb248VD47XG4gIG50aChmcm9tOiBudW1iZXIpOiBPcHRpb248VD4ge1xuICAgIGxldCBsZW4gPSB0aGlzLnN0YWNrLmxlbmd0aDtcbiAgICByZXR1cm4gZnJvbSA+PSBsZW4gPyBudWxsIDogdGhpcy5zdGFja1tmcm9tXTtcbiAgfVxuXG4gIG50aEJhY2soZnJvbTogbnVtYmVyKTogT3B0aW9uPFQ+IHtcbiAgICBsZXQgbGVuID0gdGhpcy5zdGFjay5sZW5ndGg7XG4gICAgcmV0dXJuIGxlbiA8IGZyb20gPyBudWxsIDogdGhpcy5zdGFja1tsZW4gLSBmcm9tXTtcbiAgfVxuXG4gIHRvQXJyYXkoKTogW1QsIC4uLlRbXV0ge1xuICAgIHJldHVybiB0aGlzLnN0YWNrO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9